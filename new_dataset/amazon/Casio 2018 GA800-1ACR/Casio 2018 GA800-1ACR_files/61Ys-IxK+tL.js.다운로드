(function(v){var m=window.AmazonUIPageJS||window.P,p=m._namespace||m.attributeErrors,x=p?p("VSERelatedVideosClientAssets",""):m;x.guardFatal?x.guardFatal(v)(x,window):x.execute(function(){v(x,window)})})(function(v,m,p){(function(){function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}function T(a,b){b={contentId:""+a.initialVideo.contentId,customerId:a.customerId,foresterMetadataParams:{client:a.requestMetadata.clientId,
marketplaceId:a.requestMetadata.marketplaceId,method:a.requestMetadata.method,requestId:a.requestMetadata.requestId,session:a.requestMetadata.sessionId},mediaSourceInfo:[""+a.initialVideo.videoUrl],posterSource:a.initialVideo.imageUrl,pageAsin:a.requestMetadata.pageAsin,parentId:b,vendorCode:a.initialVideo.vendorCode,videoAds:a.videoAds,shouldStartMuted:a.shouldStartMuted,shouldAutoplay:a.shouldAutoplay,shouldDisableControls:a.shouldDisableControls,useCarousel:a.useCarousel,useBuyBox:a.useBuyBox,
languagePreferenceStrings:a.languagePreferenceStrings,sushiMetricsConfig:{eventSource:a.sushiMetricsConfig.eventSource,endpoint:a.sushiMetricsConfig.endpoint,requestId:a.sushiMetricsConfig.requestId,sessionId:a.sushiMetricsConfig.sessionId,customerId:a.sushiMetricsConfig.customerId,refMarkers:a.sushiMetricsConfig.refMarkers,sessionType:a.sushiMetricsConfig.sessionType,placementContext:a.sushiMetricsConfig.placementContext,marketplaceId:a.sushiMetricsConfig.marketplaceId,weblabIds:a.sushiMetricsConfig.weblabIds,
pageAsin:a.sushiMetricsConfig.pageAsin,isInternal:a.sushiMetricsConfig.isInternal,isRobot:a.sushiMetricsConfig.isRobot,clientId:a.sushiMetricsConfig.clientId},refTag:a.refTag,ospData:{vendorTrackingId:a.initialVideo.vendorTrackingId,videoReferenceId:a.initialVideo.videoReferenceId,productAsin:a.initialVideo.productAsin}};a.eventTimestamp&&(b.eventTimestamp=a.eventTimestamp);return b}m.vseFeatures=m.vseFeatures||{};var G=m.gatedP||{register:function(a,b,f,d,c){void 0===c&&(c=m.vseFeatures);v.now(a).execute(a+
"-prereg",function(e){e||c[b]||(c[b]=!0,d.resolve(f(d)).then(function(){v.now(a).execute(a+"-reg",function(f){f||(v.log("Gated registration failed to register module!","ERROR",a),c[b]=!1)})}))})},declare:function(a,b,f,d){void 0===d&&(d=m.vseFeatures);v.now(a).execute(a+"-prereg",function(c){c||d[b]||(d[b]=!0,v.declare(a,f))})}},u={count:function(a,b){var f=m.ue;f&&f.count("vse:csm:"+a,b)},emitSushiMetric:function(a,b,f){var d=this;b=b||"https://unagi-na.amazon.com/1/events/com.amazon.eel.vse.metricstest.nexus";
f=f||0;if(!(3<=f)){var c=JSON.stringify(a).replace(/\\\\/g,""),e={params:c,paramsFormat:"json",contentType:"application/json; charset\x3dutf-8",error:function(){d.emitSushiMetric(a,b,++f)}},g=navigator.userAgent.match(/iPhone/i),t=!1;v.now("mash").execute("vse-detect-mshop",function(){t=!0});var w=null!==g&&t;v.when("A").execute("Emit-VSE-Metrics",function(a){navigator&&navigator.sendBeacon&&!w?navigator.sendBeacon(b,c):a.post(b,e)})}},logFatal:function(a,b,f){m.ueLogError&&m.ueLogError(f,{logLevel:"FATAL",
attribution:a,message:b})},logError:function(a,b,f){m.ueLogError&&m.ueLogError(f,{logLevel:"ERROR",attribution:a,message:b})}},C={makeApplicationSushiPayloadBuilder:function(a,b){return function(f){var d={eventSource:b.eventSource,requestId:b.requestId,sessionId:b.sessionId,placementContext:b.placementContext,marketplaceId:b.marketplaceId,weblabIds:b.weblabIds,clientId:b.clientId,isInternal:b.isInternal.toString(),isRobot:b.isRobot.toString(),pageAsin:b.pageAsin,customerId:b.customerId,sessionType:b.sessionType||
1,refMarkers:b.refMarkers,eventId:x(),timestamp:new Date,userAgentData:navigator.userAgent,titleSessionId:0,videoAsin:0,pageUrl:null!==m.location.href?m.location.href.substring(0,500):"",videoAsinList:b.videoAsinList||""};return{events:[{data:a.$.extend(d,f)}]}}}},z={fetchLatestPageState:function(a,b){a.state.replace(b,JSON.parse(a.$("script[type\x3d'a-state'][data-a-state*\x3d"+b+"]").html()));return a.state(b)},isDefined:function(a){return"undefined"!==typeof a&&null!==a}},r={updateReftagParam:function(a,
b){return r.updateQueryStringParameter(a,"ref_?","ref",b)},updateQueryStringParameter:function(a,b,f,d){b=new RegExp("([?\x26/])"+b+"\x3d.*?(\x26|$)","i");var c=-1!==a.indexOf("?")?"\x26":"?";return a.match(b)?a.replace(b,"$1"+f+"\x3d"+d+"$2"):a+c+f+"\x3d"+d},generateUUID:function(){for(var a="",b=0;13>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return a},logFatal:function(a,b){var f="VSE_SHARE_WITH_FRIENDS_JS_WIDGET";b&&(f=f+"_"+
b);v.log(a,"FATAL",f);return!0},decodeEntities:function(a){var b=document.createElement("textarea");b.innerHTML=a;return b.value},triggerShare:function(a,b,f,d){if(b){b=screen.width;var c=screen.height;f=f?f:.7*b;d=d?d:.7*c;m.open(a,"_blank","toolbar\x3d0,status\x3d0,width\x3d"+f+",height\x3d"+d+",top\x3d"+(c/2-d/2)+",left\x3d"+(b/2-f/2))}else m.open(a,"_self")},getPageData:function(a){return"undefined"!==typeof a.pageLevelStateKey?A.state(a.pageLevelStateKey):a.pageLevelData},buildUrl:function(a,
b){b=b||{};for(var f=m.navigator&&m.navigator.userAgent&&m.navigator.userAgent.match(/iPhone/i),d=Object.keys(b),c=0<d.length&&("sms:"!==a||!f)?"?":"",f=0;f<d.length;f++)"?"!==c&&(c+="\x26"),b[d[f]]&&(c+=d[f]+"\x3d"+encodeURIComponent(b[d[f]]));return a+c},generateReftags:function(a,b){var f,d;a=r.getPageData(a);"undefined"!==typeof a&&(f=a.clientRef,d=a.deviceTypeRef);f=f?f:"un";d=d?d:"un";a=b?b:"un";b=r.generateUUID();a="cm_sw_"+a;f=f+"_"+d+"_"+b;return{returnReftag:a+"_r_"+f,clickReftag:a+"_c_"+
f}}},V={share:function(a,b){b={facebook:{shareEndpoint:"https://www.facebook.com/dialog/share",params:function(b){return{href:r.decodeEntities(b.url),display:"popup",quote:b.quote?r.decodeEntities(b.quote):"",app_id:"164734381262"}},ref:"fb",height:450,width:700,isWebShare:!0},pinterest:{shareEndpoint:"https://www.pinterest.com/pin/create/button",params:function(b){return{url:r.decodeEntities(b.url),media:r.decodeEntities(b.image),description:r.decodeEntities(b.description)}},ref:"pi",height:620,
width:700,isWebShare:!0},twitter:{shareEndpoint:"https://twitter.com/intent/tweet",params:function(b){var a=r.decodeEntities(b.title);b=r.decodeEntities(b.url);if(a){var f=b?Math.min(b.length,20):-1;200<a.length+f+1&&(a=a.substring(0,200-(f+1+3))+"...")}return{text:a,url:b}},ref:"tw",height:470,width:670,isWebShare:!0},email:{shareEndpoint:"mailto:",params:function(b){return{subject:r.decodeEntities(b.title),body:r.decodeEntities(b.description)+"\n"+r.decodeEntities(b.url)}},ref:"em",height:470,width:670,
isWebShare:!1},sms:{shareEndpoint:"sms:",params:function(b){return{body:r.decodeEntities(b.title)+" "+r.decodeEntities(b.url)}},ref:"sm",height:470,width:670,isWebShare:!1},whatsapp:{shareEndpoint:"https://api.whatsapp.com/send",params:function(b){return{text:r.decodeEntities(b.description)+"\n"+r.decodeEntities(b.url)}},ref:"wa",height:470,width:670,isWebShare:!1}}[b];var f=r.generateReftags(a,b.ref);a.url=r.updateReftagParam(a.url,f.returnReftag);a=r.buildUrl(b.shareEndpoint,b.params(a));r.triggerShare(a,
b.isWebShare,b.width,b.height)}},F={sendRequest:function(a,b,f,d,c){a.ajax(b,{params:f,paramsFormat:"json",crossDomain:!0,method:"POST",contentType:"application/json",success:d,error:c})}},E={queueComplete:!0},W=function(){function a(b,a,d){var c=this;this.player=b;this.frame=a;this.assets=[];this.currentIndex=0;this.eventEmitter=new d.EventEmitter;this.player.on("playbackComplete",function(){c.currentIndex++;c.doPlay()})}a.prototype.play=function(b){b?this.player.play(b):this.player.play();return this};
a.prototype.getCurrentTime=function(){return this.player.getCurrentTime()};a.prototype.setCurrentTime=function(b){this.player.setCurrentTime(b)};a.prototype.mute=function(){this.player.mute()};a.prototype.unmute=function(){this.player.unmute()};a.prototype.isMuted=function(){return this.player.isMuted()};a.prototype.resume=function(b){this.player.resume(b);return this};a.prototype.pause=function(){this.player.pause();return this};a.prototype.next=function(){this.player.stop();this.currentIndex++;
this.doPlay();return this};a.prototype.previous=function(){this.player.stop();this.currentIndex--;this.doPlay();return this};a.prototype.seek=function(b){this.player.seek(b);return this};a.prototype.enqueue=function(b,a){void 0===a&&(a=this.assets.length);b instanceof Array?(b=b.slice(),b.splice(0,0,this.assets),Array.prototype.splice.apply(this.assets,b)):this.assets.splice(a,0,b);return this};a.prototype.dequeue=function(b){var a=this,d;if("number"===typeof b)d=[b];else if(b instanceof Array){var c=
b.map(function(b){return b.contentId});d=this.assets.map(function(b){return c.indexOf(b.contentId)}).filter(function(b){-1!=b})}else d=[this.assets.map(function(b,a){return a}).filter(function(d){a.assets[d].contentId==b.contentId})[0]];for(var e=0,g=d.length;e<g;e++)this.assets.splice(d[e],1);return this};a.prototype.on=function(b,a){if(E.hasOwnProperty(b))this.eventEmitter.on(b,a);else this.player.on(b,a);return this};a.prototype.off=function(b,a){E.hasOwnProperty(b)?this.eventEmitter.off(b,a):
this.player.off(b,a);return this};a.prototype.onTime=function(b,a,d){this.player.onTime(b,a,d);return this};a.prototype.offTime=function(b,a,d){this.player.offTime(b,a,d);return this};a.prototype.onAd=function(b,a){this.player.onAd(b,a);return this};a.prototype.offAd=function(b,a){this.player.offAd(b,a);return this};a.prototype.show=function(){return this};a.prototype.hide=function(){return this};a.prototype.getAssets=function(){return this.assets};a.prototype.getCurrentAssetIndex=function(){return this.currentIndex-
1};a.prototype.getPosition=function(){return this.player.getPosition()};a.prototype.isPlaying=function(){return this.player.isPlaying()};a.prototype.isPaused=function(){return this.player.isPaused()};a.prototype.getVersion=function(){return this.player.getVersion()};a.prototype.getFlashVersion=function(){return this.player.getFlashVersion()};a.prototype.getRendererType=function(){return this.player.getRendererType()};a.prototype.destroy=function(){this.player.destroy()};a.prototype.doPlay=function(){var b=
this.player.getCurrent();b?this.assets[this.currentIndex].contentId==b.contentId?this.player.play():this.player.play(this.assets[this.currentIndex]):this.assets[this.currentIndex]&&this.player.play(this.assets[this.currentIndex])};return a}(),X=function(){function a(b,a,d,c){this.libs=c;this.eventEmitter=new c.EventEmitter;this.currentAsset=d;this.initHandlers();d=document.getElementById(a.parentId);c=document.createElement("video");var e=a.parentId+"-element";c.id=e;c.className="video-js brila-video-js";
c.setAttribute("playsinline","true");a.shouldDisableControls||c.setAttribute("controls","true");a.shouldAutoplay&&c.setAttribute("autoplay","true");a.shouldStartMuted&&c.setAttribute("muted","true");d.appendChild(c);var g=this;b.embedPromise(e,a,{player:{techOrder:["html5"]}}).then(function(d){g.videoJS=d;document.getElementById(e).setAttribute("style","width:100%; height:100%;");g.videoJS.poster(a.posterSource);g.videoJS.aspectRatio("16:9");g.videoJS.src(a.mediaSourceInfo[0]);g.vseMetrics=b.metrics(g.videoJS);
a.videoAds&&a.videoAds.isEngineEnabled&&(g.vseAds=b.ads(g.videoJS));g.videoJS.on("ended",function(){g.eventHandlers.onPlaybackComplete()});g.videoJS.on("playing",function(){g.eventHandlers.onPlaybackStart()});g.eventEmitter.emit("playerLoaded")})}a.prototype.play=function(b){!b||this.currentAsset&&b.contentId==this.currentAsset.contentId||(this.videoJS.poster(b.imageUrl),this.videoJS.posterImage.show(),this.vseMetrics.setContentId&&this.vseMetrics.setContentId(b.contentId),this.vseMetrics.setRefTag&&
this.vseMetrics.setRefTag(b.refTag?b.refTag:""),this.vseMetrics.setOspAttribution&&this.vseMetrics.setOspAttribution({vendorTrackingId:b.vendorTrackingId?b.vendorTrackingId:"",videoReferenceId:b.videoReferenceId?b.videoReferenceId:"",productAsin:b.productAsin?b.productAsin:""}),this.vseAds&&(this.vseAds.setContentId(b.contentId),this.vseAds.setVendorCode(b.vendorCode)),this.videoJS.src(b.videoUrl),this.currentAsset=b);b=b&&b.eventTimestamp?b.eventTimestamp:Date.now();this.vseMetrics.setPageLoadStartTimestamp(b);
return this.videoJS.play()};a.prototype.muted=function(b){return this.videoJS.muted(b)};a.prototype.mute=function(){this.videoJS.muted(!0)};a.prototype.unmute=function(){this.videoJS.muted(!1)};a.prototype.isMuted=function(){return this.videoJS.muted()};a.prototype.getCurrentTime=function(){return this.videoJS.currentTime()};a.prototype.setCurrentTime=function(b){this.videoJS.currentTime(b)};a.prototype.pause=function(){this.videoJS.pause();return this};a.prototype.resume=function(b){this.videoJS.play();
return this};a.prototype.seek=function(b){this.videoJS.currentTime(b);return this};a.prototype.stop=function(){this.videoJS.pause();this.currentAsset=p;return this};a.prototype.on=function(b,a){this.eventEmitter.on(b,a);return this};a.prototype.off=function(b,a){return this};a.prototype.onTime=function(b,a,d){return this};a.prototype.offTime=function(b,a,d){return this};a.prototype.onAd=function(b,a){return this};a.prototype.offAd=function(b,a){return this};a.prototype.getCurrent=function(){return this.currentAsset};
a.prototype.getPosition=function(){return this.videoJS.currentTime()};a.prototype.isPlaying=function(){return!this.videoJS.paused()};a.prototype.isPaused=function(){return this.videoJS.paused()};a.prototype.getVersion=function(){return"VJS"};a.prototype.getFlashVersion=function(){return""};a.prototype.getRendererType=function(){return""};a.prototype.destroy=function(){this.vseMetrics.publishBeforeDispose();this.videoJS.off("ended",this.eventHandlers.onPlaybackComplete);this.videoJS.dispose();this.videoJS=
null};a.prototype.initHandlers=function(){var b=this;this.eventHandlers={onPlaybackComplete:function(){return b.player_onPlaybackComplete()},onPlaybackStart:function(){return b.player_onPlaybackStart()}}};a.prototype.player_onPlaybackComplete=function(){if(!this.vseAds||!this.vseAds.isAdPlaying()){var b=this.currentAsset;this.currentAsset=p;b&&(b.eventTimestamp=Date.now());this.eventEmitter.emit("playbackComplete",b)}};a.prototype.player_onPlaybackStart=function(){this.currentAsset&&(this.currentAsset.eventTimestamp=
Date.now());this.eventEmitter.emit("playbackStart",this.currentAsset)};return a}(),Y=function(){function a(b,a){var d=this;this.libs=a;this.commands=[];b.then(function(b){d.playerInstance=b;d.executeCommands()})}a.prototype.executeCommands=function(){for(var b=0;b<this.commands.length;b++)this.commands[b](this.playerInstance)};a.prototype.play=function(b){var a=this;this.playerInstance?this._play(b,this.playerInstance):this.commands.push(function(){for(var d=[],c=0;c<arguments.length;c++)d[c]=arguments[c];
return a._play(b,d[0])});return this};a.prototype.mute=function(){var b=this;this.playerInstance?this._mute(this.playerInstance):this.commands.push(function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b._mute(a[0])})};a.prototype.unmute=function(){var b=this;this.playerInstance?this._unmute(this.playerInstance):this.commands.push(function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b._unmute(a[0])})};a.prototype.isMuted=function(){var b=this;if(this.playerInstance)return this._isMuted(this.playerInstance);
this.commands.push(function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b._isMuted(a[0])});return!0};a.prototype.getCurrentTime=function(){var b=this;if(this.playerInstance)return this._getCurrentTime(this.playerInstance);this.commands.push(function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b._getCurrentTime(a[0])});return 0};a.prototype.setCurrentTime=function(b){var a=this;this.playerInstance?this._setCurrentTime(b,this.playerInstance):this.commands.push(function(){for(var d=
[],c=0;c<arguments.length;c++)d[c]=arguments[c];return a._setCurrentTime(b,d[0])})};a.prototype.pause=function(){var b=this;this.playerInstance?this._pause(this.playerInstance):this.commands.push(function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b._pause(a[0])});return this};a.prototype.resume=function(b){var a=this;this.playerInstance?this._resume(b,this.playerInstance):this.commands.push(function(){for(var d=[],c=0;c<arguments.length;c++)d[c]=arguments[c];return a._resume(b,
d[0])});return this};a.prototype.stop=function(){var b=this;this.playerInstance?this._stop(this.playerInstance):this.commands.push(function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b._stop(a[0])});return this};a.prototype.seek=function(b){var a=this;this.playerInstance?this._seek(b,this.playerInstance):this.commands.push(function(){for(var d=[],c=0;c<arguments.length;c++)d[c]=arguments[c];return a._seek(b,d[0])});return this};a.prototype.on=function(b,a){var d=this;this.playerInstance?
this._on(b,a,this.playerInstance):this.commands.push(function(){for(var c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];return d._on(b,a,c[0])});return this};a.prototype.off=function(b,a){var d=this;this.playerInstance?this._off(b,a,this.playerInstance):this.commands.push(function(){for(var c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];return d._off(b,a,c[0])});return this};a.prototype.onTime=function(b,a,d){var c=this;this.playerInstance?this._onTime(b,a,d,this.playerInstance):this.commands.push(function(){for(var e=
[],g=0;g<arguments.length;g++)e[g]=arguments[g];return c._onTime(b,a,d,e[0])});return this};a.prototype.offTime=function(b,a,c){var h=this;this.playerInstance?this._offTime(b,a,c,this.playerInstance):this.commands.push(function(){for(var e=[],g=0;g<arguments.length;g++)e[g]=arguments[g];return h._offTime(b,a,c,e[0])});return this};a.prototype.onAd=function(b,a){var c=this;this.playerInstance?this._onAd(b,a,this.playerInstance):this.commands.push(function(){for(var h=[],e=0;e<arguments.length;e++)h[e]=
arguments[e];return c._onAd(b,a,h[0])});return this};a.prototype.offAd=function(b,a){var c=this;this.playerInstance?this._offAd(b,a,this.playerInstance):this.commands.push(function(){for(var h=[],e=0;e<arguments.length;e++)h[e]=arguments[e];return c._offAd(b,a,h[0])});return this};a.prototype.getCurrent=function(){if(this.playerInstance)return this.playerInstance.getCurrent()};a.prototype.getPosition=function(){return this.playerInstance?this.playerInstance.getPosition():0};a.prototype.isPlaying=
function(){return this.playerInstance?this.playerInstance.isPlaying():!1};a.prototype.isPaused=function(){return this.playerInstance?this.playerInstance.isPaused():!1};a.prototype.getVersion=function(){return this.playerInstance?this.playerInstance.getVersion():""};a.prototype.getFlashVersion=function(){return this.playerInstance?this.playerInstance.getFlashVersion():""};a.prototype.getRendererType=function(){return this.playerInstance?this.playerInstance.getRendererType():""};a.prototype.destroy=
function(){this.playerInstance&&this.playerInstance.destroy();this.playerInstance=null};a.prototype._play=function(b,a){b?a.play(b):a.play()};a.prototype._mute=function(b){b.mute()};a.prototype._unmute=function(b){b.unmute()};a.prototype._isMuted=function(b){return b.isMuted()};a.prototype._getCurrentTime=function(b){return b.getCurrentTime()};a.prototype._setCurrentTime=function(b,a){a.setCurrentTime(b)};a.prototype._pause=function(b){b.pause()};a.prototype._stop=function(b){b.stop()};a.prototype._resume=
function(b,a){a.resume(b)};a.prototype._seek=function(b,a){a.seek(b)};a.prototype._on=function(b,a,c){c.on(b,a)};a.prototype._off=function(b,a,c){c.off(b,a)};a.prototype._onTime=function(b,a,c,h){h.onTime(b,a,c)};a.prototype._offTime=function(b,a,c,h){h.offTime(b,a,c)};a.prototype._onAd=function(b,a,c){c.onAd(b,a)};a.prototype._offAd=function(b,a,c){c.offAd(b,a)};a.prototype._destroy=function(b){b.destroy()};return a}(),J=function(){function a(b){this.deps=b}a.prototype.create=function(b){var a=this,
c=x(),h=new this.deps.promise(function(b,a){m[c]={resolve:b,reject:a}});v.when("brila").execute("construct-player",function(b){m[c].resolve(b)});var e=document.getElementById(b.containerId),g=b.containerId+"-container";e.innerHTML='\x3cdiv id\x3d"'+g+'" style\x3d"width:100%; height:100%"\x3e\x3c/div\x3e';e=(new this.deps.promise(function(c,d){h.then(function(d){var e=new X(d,T(b,g),b.initialVideo,a.deps);e.on("playerLoaded",function(){c(e)})})})).then(function(b){return b});return new W(new Y(e,this.deps),
document.getElementById(g),this.deps)};return a}(),Z=function(){function a(b,a){void 0===a&&(a={refTagRecorderEndPoint:"/gp/mobile/tag/",retryLimit:3});this.A=b;this.config=a}a.prototype.emitRefTag=function(b,a){void 0===a&&(a=0);if(!(a>=this.config.retryLimit)){var c=this;this.A.post(this.config.refTagRecorderEndPoint+"ref\x3d"+b,{error:function(){c.emitRefTag(b,++a)}})}};return a}(),k=function(){function a(){}a.POSITIVE_VOTE="positive";a.NEGATIVE_VOTE="negative";a.NONE_VOTE="none";a.EMPTY_STRING=
"";a.DEFAULT_MIN_GUTTER=24;a.DEFAULT_HEIGHT_ANIMATION_SPEED=200;a.ATTR_ANIMATING="animating";a.ATTR_CURRENT_GUTTER="currentGutter";a.ATTR_FIRST_ITEM_FLUSH_LEFT="first_item_flush_left";a.ATTR_FIRST_VISIBLE_ITEM="firstVisibleItem";a.ATTR_HEIGHT_ANIMATION_SPEED="height_animation_speed";a.ATTR_HIDE_OFFSCREEN="hide_off_screen";a.ATTR_MAX_HEIGHT="maxHeight";a.ATTR_MIN_GUTTER="minimum_gutter_width";a.ATTR_PAGE_NUMBER="pageNumber";a.ATTR_PAGE_SIZE="pageSize";a.ATTR_SET_SIZE="set_size";a.ATTR_SHOW_PARTIAL=
"show_partial_next";a.ATTR_SINGLE_PAGE_ALIGN="single_page_align";a.ATTR_TOTAL_PAGES="totalPages";a.FIRST_PAGE="first-page";a.LAST_PAGE="last-page";a.$VSE_DISPLAY_STRATEGY_ELEMENT=".a-carousel-display-vse";a.$RVS_G1=".RVS_G1";a.$RVS_G2=".RVS_G2";return a}(),D=function(){function a(b,a){this.element=b;this.videoVoteConfig=a;this.countsFetched=!1;this.positiveVoteCount=0;this.showPositiveVotes=!1;this.negativeVoteCount=0;this.showNegativeVotes=!1;this.prompt=b.find(".vse-vote-helpful-text");this.positiveVoteText=
b.find(".vse-vote-positive");this.positiveVoteIcon=b.find(".vse-vote-positive-icon");this.negativeVoteText=b.find(".vse-vote-negative");this.negativeVoteIcon=b.find(".vse-vote-negative-icon");this.previousVote=k.EMPTY_STRING}a.prototype.getVoteCount=function(b){return b===k.POSITIVE_VOTE?this.positiveVoteCount:b===k.NEGATIVE_VOTE?this.negativeVoteCount:0};a.prototype.setVoteCount=function(b,a){0>a&&(a=0);b===k.POSITIVE_VOTE?(this.positiveVoteCount=a,this.positiveVoteText.html(String(a))):b===k.NEGATIVE_VOTE&&
(this.negativeVoteCount=a,this.negativeVoteText.html(String(a)));this.element.addClass("updated")};a.prototype.getPreviousVote=function(){return this.previousVote};a.prototype.setPreviousVote=function(b){if(b===k.POSITIVE_VOTE)this.positiveVoteIcon.addClass("hasvoted"),this.negativeVoteIcon.removeClass("hasvoted"),0>=this.getVoteCount(k.POSITIVE_VOTE)&&this.setVoteCount(k.POSITIVE_VOTE,1);else if(b===k.NEGATIVE_VOTE)this.negativeVoteIcon.addClass("hasvoted"),this.positiveVoteIcon.removeClass("hasvoted"),
0>=this.getVoteCount(k.NEGATIVE_VOTE)&&this.setVoteCount(k.NEGATIVE_VOTE,1);else if(b===k.NONE_VOTE)this.negativeVoteIcon.removeClass("hasvoted"),this.positiveVoteIcon.removeClass("hasvoted");else return;this.previousVote=b};a.prototype.setContentId=function(b){this.contentId=b};a.prototype.getContentId=function(){return this.contentId};a.prototype.showOrHide=function(b,a,c,h){this.showPositiveVotes=b;this.showNegativeVotes=a;this.showPrompt=c;b?(this.positiveVoteText.addClass("show"),this.positiveVoteIcon.addClass("show")):
(this.positiveVoteText.removeClass("show"),this.positiveVoteIcon.removeClass("show"));a?(this.negativeVoteText.addClass("show"),this.negativeVoteIcon.addClass("show")):(this.negativeVoteText.removeClass("show"),this.negativeVoteIcon.removeClass("show"));c?this.prompt.addClass("show"):this.prompt.removeClass("show");h?this.element.addClass("show"):this.element.removeClass("show")};a.prototype.updateWithNewVote=function(b){if(b===k.POSITIVE_VOTE||b===k.NEGATIVE_VOTE){var a=b==k.POSITIVE_VOTE?k.NEGATIVE_VOTE:
k.POSITIVE_VOTE,c=this.getVoteCount(b),h=this.getVoteCount(a);b===this.getPreviousVote()?(this.setPreviousVote(k.NONE_VOTE),this.setVoteCount(b,c-1)):this.getPreviousVote()!==k.EMPTY_STRING&&this.getPreviousVote()!==k.NONE_VOTE?(this.setVoteCount(a,h-1),this.setVoteCount(b,c+1),this.setPreviousVote(b)):(this.setPreviousVote(b),this.setVoteCount(b,c+1))}};return a}(),K=function(){return function(a,b,f){this.contentId=a;this.positiveVoteCount=b;this.negativeVoteCount=f}}(),L=function(){return function(a){this.name=
"InvalidArugmentsException";this.message=a}}(),H=function(){function a(b,a){this.A=b;this.videoVoteConfig=a}a.prototype.createFromContent=function(b,a){b=this.A.$("#"+b).find('[.vse-video-votes][data-contentid\x3d"'+a+'"]');return new D(b,this.videoVoteConfig)};a.prototype.createFromSelector=function(b){var a=this.A.$(""+b);if(!a)throw new L("VideoVoteContainerFactory can not find selector by the name of "+b+".");return new D(a,this.videoVoteConfig)};a.prototype.sendVoteToRemote=function(b,a,c){var h=
this,e=null,g=!1;this.videoVoteConfig.forceTreatment&&(e=[{name:"VSE_VIDEOVOTES_IMAGE_BLOCK_195012",assignment:"T1"}],g=!0);var t={contentId:c,placement:this.videoVoteConfig.placementContext,positive:b,negative:a,requestId:this.videoVoteConfig.requestId,sessionId:this.videoVoteConfig.sessionId,page:this.videoVoteConfig.page,experimentWeblab:this.videoVoteConfig.experimentWeblab,weblabContext:e,bypassLogin:g};return new this.videoVoteConfig.dependencies.promise(function(b,a){h.A.ajax("/vap/ew/subcomponent/votes/writing",
{params:t,paramsFormat:"json",crossDomain:!0,method:"POST",contentType:"application/json",success:function(a){b(a)},error:function(b){u.count("votecast:failed",1);a(b)}})})};a.prototype.fetchVoteHistory=function(b){var a=this,c=null,h=!1;this.videoVoteConfig.forceTreatment&&(c=[{name:"VSE_VIDEOVOTES_IMAGE_BLOCK_195012",assignment:"T1"}],h=!0);var e={contentId:b,placement:this.videoVoteConfig.placementContext,requestId:this.videoVoteConfig.requestId,sessionId:this.videoVoteConfig.sessionId,page:this.videoVoteConfig.page,
experimentWeblab:this.videoVoteConfig.experimentWeblab,weblabContext:c,bypassLogin:h};return new this.videoVoteConfig.dependencies.promise(function(b,c){a.A.ajax("/vap/ew/subcomponent/votes/status",{params:e,paramsFormat:"json",crossDomain:!0,method:"POST",contentType:"application/json",success:function(a){b(a)},error:function(b){u.count("votehistory:failed",1);c(b)}})})};a.prototype.convertPayloadToVoteData=function(b){var a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(new K(c,b[c].positive,b[c].negative));
return a};a.prototype.fetchVoteCounts=function(b){var a=this,c=null,h=!1;this.videoVoteConfig.forceTreatment&&(c=[{name:"VSE_VIDEOVOTES_IMAGE_BLOCK_195012",assignment:"T1"}],h=!0);var e={contentIds:b,placement:this.videoVoteConfig.placementContext,requestId:this.videoVoteConfig.requestId,sessionId:this.videoVoteConfig.sessionId,page:this.videoVoteConfig.page,experimentWeblab:this.videoVoteConfig.experimentWeblab,weblabContext:c,bypassLogin:h};return new this.videoVoteConfig.dependencies.promise(function(b,
c){a.A.ajax("/vap/ew/subcomponent/votes",{params:e,paramsFormat:"json",crossDomain:!0,method:"POST",contentType:"application/json",success:function(d){d=a.convertPayloadToVoteData(d);0<d.length&&b(d);c(d)},error:function(b){u.count("votegetcounts:failed",1);c(b)}})})};return a}(),aa=function(){function a(b){this.config=b;this.$stickies=null;this.$container=this.config.A.$(this.config.stickyHeaderContainer);this.$lbContainer=this.config.A.$(this.config.stickyHeaderLBContainer);this.lbModalContainer=
this.config.lbModalContainer;this.gutter=this.$container.offset().top;this.topPosition=this.$container.offset().top-this.$lbContainer.closest(this.lbModalContainer).offset().top}a.prototype.load=function(b){if("object"===typeof b&&0<b.length){var a=this;this.$stickies=b.each(function(b){b=a.config.A.$(this).parents(".vse-follow-wrap").length?a.config.A.$(this):a.config.A.$(this).wrap('\x3cdiv class\x3d"vse-follow-wrap" /\x3e');b.data("originalPosition",b.offset().top+a.$container.scrollTop()-a.gutter).data("originalHeight",
b.outerHeight()).parent().height(b.outerHeight(!0))});this.$container.unbind("scroll");this.$container.bind("scroll",function(){a._whenScrolling()});this.$container.scroll()}};a.prototype._whenScrolling=function(){var b=this;this.$stickies.each(function(a){a=b.config.A.$(this);var c=a.data("originalPosition"),h=b.$container.scrollTop();c<=h?a.addClass("vse-absolute").css({top:h}):a.removeClass("vse-absolute").removeAttr("style")})};return a}(),ba=function(){function a(b,a,c,h,e){var g=this;this.carouselFramework=
a;this.A=c;this.contentCarouselConfig=h;this.deps=e;this.vseAssets=[];this.vseAssetIndex={};this.voteContainerIndex={};this.carouselPageSize=this.carouselTotalPages=0;this.carouselPageNumber=1;this.getplaylist=function(){return g.vseAssets.slice()};this.getActiveAsset=function(){return g.activeAsset};this.scrollTo=function(){if(g.contentCarouselConfig.hasStickyHeaders){var b=g.A.$("#"+g.contentCarouselConfig.carouselName).closest(".vse-lb-right"),a=0;0===g.activeCard.find(".vse-vc-header.first-item").length&&
(a=g.A.$(".vse-follow-wrap").first().height()-2);b.animate({scrollTop:g.activeCard.offset().top-b.offset().top+b.scrollTop()-a})}else g.A.$("#"+g.contentCarouselConfig.carouselName).animate({scrollTop:g.activeCard.offset().top-g.A.$("#"+g.contentCarouselConfig.carouselName).offset().top+g.A.$("#"+g.contentCarouselConfig.carouselName).scrollTop()})};this.rotateTo=function(b){g.markPlaying(b);g.contentCarouselConfig.isVerticalScroll&&g.scrollTo();0!==g.carouselPageSize&&(b=g.findIndex(b),-1!==b&&(b=
Math.floor(b/g.carouselPageSize)+1,g.carouselPageNumber!=b&&g.auiCarousel.gotoPage(b)))};this.markPlaying=function(b){g.activeAsset=b;g.activeCard.removeClass("active");g.activeCard=g.vseAssetIndex[b.contentId].$el.closest("li").addClass("active")};this.findIndex=function(b){return g.vseAssets.indexOf(g.vseAssetIndex[b.contentId])};this.emitRefTag=function(b,a){0<g.listOffset&&(b=(b-g.listOffset+g.vseAssets.length)%g.vseAssets.length);g.refTagRecorder.emitRefTag(a+b)};this.destroy=function(){g.A.$("#"+
g.contentCarouselConfig.carouselName+" .a-carousel-card.active").removeClass("active")};this.updateVotingElements=function(b,a){g.A.each(b,function(b){var c=g.vseAssetIndex[b.contentId].videoVoteContainer;c.setVoteCount(k.POSITIVE_VOTE,b.positiveVoteCount);c.setVoteCount(k.NEGATIVE_VOTE,b.negativeVoteCount);c.countsFetched=!0;c.showOrHide(a,a,!1,a)})};this.attachStickyHeader=function(b){g.stickyHeaders=new aa(b);g.stickyHeaders.load(g.A.$(b.stickyHeaderContainer+" .vse-vc-header.first-item"))};this.getAssetSpec=
function(b,a,c){var f=b.data(),d=b.find(".vse-video-image").data("img"),d=d.replace("SR160,90_BG0,0,0_PKvse-overlay-play2","").replace("SR320,180_BG0,0,0_PKvse-overlay-play2","");return{contentId:f.asin,title:f.title,vendorName:f.vendorName,vendorCode:f.vendorCode,referenceUrl:f.referenceUrl,referenceLinkTitle:f.referenceTitle,videoUrl:f.videoUrl,$el:b,duration:f.duration,imageUrl:d,sponsored:f.sponsored,videoVoteContainer:g.voteContainerIndex[f.asin],productAsin:f.productAsin,refTag:c+a,relatedProducts:f.relatedProducts,
vendorTrackingId:f.vendorTrackingId,videoReferenceId:f.videoRefId}};var t=c.$;this.activeCard=t([]);var w=this;this.auiCarousel=b;this.refTagRecorder=new Z(c);t("#"+h.carouselName).find(".a-carousel-heading").after(t("#"+h.carouselName).find(".vse-upload-link").removeClass("aok-hidden"));t("#"+h.carouselName+" .vse-video-item").each(function(b){b=w.getAssetSpec(t(this),b,w.contentCarouselConfig.refTagPrefix);w.vseAssets.push(b);w.vseAssetIndex[b.contentId]=b});h.showVideoVotes&&h.videoVoteConfig&&
(this.videoVoteContainerFactory=new H(c,h.videoVoteConfig),c.each(this.vseAssetIndex,function(b){g.voteContainerIndex[b.contentId]=g.videoVoteContainerFactory.createFromContent(g.contentCarouselConfig.carouselName,b.contentId);b.videoVoteContainer=g.voteContainerIndex[b.contentId]}));t("#"+h.carouselName+" .vse-video-card").find(k.$RVS_G1).first().addClass("first-item");t("#"+h.carouselName+" .vse-video-card").find(k.$RVS_G2).first().addClass("first-item");h.showAdPlacement||t("#"+h.carouselName).delegate(".a-carousel-card a",
"click",function(b){if(t(this).closest("li").hasClass("active"))b.preventDefault();else{var a=w.vseAssetIndex[t(this).closest("li").find(".vse-video-item").data("asin")];w.markPlaying(a);a.eventTimestamp=Date.now();c.trigger("vse:contentCarousel:"+h.carouselName+":click",a);a=w.findIndex(a);w.emitRefTag(a,w.contentCarouselConfig.refTagPrefix);h.isPreventDefault&&b.preventDefault()}});t("#"+h.carouselName+" .vse-carousel-item").each(function(b){var a=t(this);if(h.showAdPlacement){a.attr("href",a.data("redirect-url")+
"?ref\x3ddp_vse_rva1_pc");var f=a.parent().data("asin");a.parent().delegate(".vse-carousel-item","click",function(b){c.trigger("vse:rva:carousel:"+h.carouselName+":productClick",{relatedProductAsin:f,name:"vse.related_video_advertising.productClick"})})}else a.attr("href",a.data("redirect-url")+"?ref\x3d"+w.contentCarouselConfig.refTagPrefix+b)});c.off("a:carousel:"+h.carouselName+":change:pageSize");c.off("a:carousel:"+h.carouselName+":change:pageNumber");c.on("a:carousel:"+h.carouselName+":change:pageSize",
function(){g.carouselPageSize=g.auiCarousel.getAttr("pageSize");g.activeAsset&&g.rotateTo(g.activeAsset)});c.trigger("a:carousel:"+h.carouselName+":change:pageSize");c.on("a:carousel:"+h.carouselName+":change:pageNumber",function(b){var a=b.carousel;b=b.newValue;var f=a.getAttr("totalPages");a.dom.$carousel.closest(k.$VSE_DISPLAY_STRATEGY_ELEMENT).toggleClass(k.FIRST_PAGE,1===b);a.dom.$carousel.closest(k.$VSE_DISPLAY_STRATEGY_ELEMENT).toggleClass(k.LAST_PAGE,b===f);g.carouselPageNumber=g.auiCarousel.getAttr("pageNumber");
c.trigger("a:carousel:"+h.carouselName+":scrollCarousel",g.carouselPageNumber,g.carouselPageSize)});c.trigger("a:carousel:"+h.carouselName+":updatePageIndex",this.carouselPageNumber,this.carouselPageSize);c.declarative(h.carouselName+"-sm-link","click touch",function(b){t("#"+h.carouselName+" .vse-video-item .vse-carousel-item").first().click()})}a.prototype.changeStartingCardTo=function(b){var a=this;this.listOffset=this.findIndex(b);var c=this;this.A.$("#"+this.contentCarouselConfig.carouselName+
" .vse-carousel-item").each(function(b){var a=c.A.$(this);b=(b-c.listOffset+c.vseAssets.length)%c.vseAssets.length;a.attr("href",a.data("redirect-url")+"?ref\x3d"+c.contentCarouselConfig.refTagPrefix+b)});this.contentCarouselConfig.isVerticalScroll||(this.carouselFramework.initializeAll(),this.carouselFramework.onInit(""+this.contentCarouselConfig.carouselName,function(){a.rotateTo(b)}))};return a}(),ca=function(){function a(b,a,c){this.carouselFramework=b;this.A=a;this.deps=c}a.prototype.create=
function(b){var a=this.carouselFramework.getCarousel(this.A.$("#"+b.carouselName));if(!a)throw new L("Carousel framework can not find carousel by the name of "+b.carouselName+".");return new ba(a,this.carouselFramework,this.A,b,this.deps)};return a}(),M=function(a,b){return b={exports:{}},a(b,b.exports),b.exports}(function(a){function b(){}function c(b,a,f){this.fn=b;this.context=a;this.once=f||!1}function d(){this._events=new b;this._eventsCount=0}var h=Object.prototype.hasOwnProperty,e="~";Object.create&&
(b.prototype=Object.create(null),(new b).__proto__||(e=!1));d.prototype.eventNames=function(){var b=[],a,c;if(0===this._eventsCount)return b;for(c in a=this._events)h.call(a,c)&&b.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(a)):b};d.prototype.listeners=function(b,a){b=this._events[e?e+b:b];if(a)return!!b;if(!b)return[];if(b.fn)return[b.fn];a=0;for(var c=b.length,f=Array(c);a<c;a++)f[a]=b[a].fn;return f};d.prototype.emit=function(b,a,c,f,d,h){var n=
e?e+b:b;if(!this._events[n])return!1;var n=this._events[n],k=arguments.length,m,l;if(n.fn){n.once&&this.removeListener(b,n.fn,p,!0);switch(k){case 1:return n.fn.call(n.context),!0;case 2:return n.fn.call(n.context,a),!0;case 3:return n.fn.call(n.context,a,c),!0;case 4:return n.fn.call(n.context,a,c,f),!0;case 5:return n.fn.call(n.context,a,c,f,d),!0;case 6:return n.fn.call(n.context,a,c,f,d,h),!0}l=1;for(m=Array(k-1);l<k;l++)m[l-1]=arguments[l];n.fn.apply(n.context,m)}else{var r=n.length,q;for(l=
0;l<r;l++)switch(n[l].once&&this.removeListener(b,n[l].fn,p,!0),k){case 1:n[l].fn.call(n[l].context);break;case 2:n[l].fn.call(n[l].context,a);break;case 3:n[l].fn.call(n[l].context,a,c);break;case 4:n[l].fn.call(n[l].context,a,c,f);break;default:if(!m)for(q=1,m=Array(k-1);q<k;q++)m[q-1]=arguments[q];n[l].fn.apply(n[l].context,m)}}return!0};d.prototype.on=function(b,a,d){a=new c(a,d||this);b=e?e+b:b;this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],a]:this._events[b].push(a):(this._events[b]=
a,this._eventsCount++);return this};d.prototype.once=function(b,a,d){a=new c(a,d||this,!0);b=e?e+b:b;this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],a]:this._events[b].push(a):(this._events[b]=a,this._eventsCount++);return this};d.prototype.removeListener=function(a,c,f,d){a=e?e+a:a;if(!this._events[a])return this;if(!c)return 0===--this._eventsCount?this._events=new b:delete this._events[a],this;var h=this._events[a];if(h.fn)h.fn!==c||d&&!h.once||f&&h.context!==f||(0===--this._eventsCount?
this._events=new b:delete this._events[a]);else{for(var l=0,n=[],k=h.length;l<k;l++)(h[l].fn!==c||d&&!h[l].once||f&&h[l].context!==f)&&n.push(h[l]);n.length?this._events[a]=1===n.length?n[0]:n:0===--this._eventsCount?this._events=new b:delete this._events[a]}return this};d.prototype.removeAllListeners=function(a){a?(a=e?e+a:a,this._events[a]&&(0===--this._eventsCount?this._events=new b:delete this._events[a])):(this._events=new b,this._eventsCount=0);return this};d.prototype.off=d.prototype.removeListener;
d.prototype.addListener=d.prototype.on;d.prototype.setMaxListeners=function(){return this};d.prefixed=e;d.EventEmitter=d;"undefined"!==typeof a&&(a.exports=d)}).EventEmitter,q=function(){function a(){}a.cacheRelatedProductsPayloadHiddenDivId="#vse-related-products-cache-hidden";a.visibleDivNarrowPrefix="vse-pc-visible-narrow-";a.visibleDivWidePrefix="vse-pc-visible-wide-";a.narrowContainerSelector="#vse-related-products-narrow";a.narrowContainerMobileSelector="#vse-related-products-narrow-mobile";
a.wideContainerSelector="#vse-related-products-wide";a.relatedProductsInnerContainer=".vse-related-product-container";a.activeProductCarousel=".vse-pc-visible";return a}(),da=function(){function a(b,a,c,h,e,g,t,l,U,m,r,n,p,v,u){var B=this;this.wrapper=b;this.useSecondaryView=a;this.$=c;this.A=h;this.showSegments=e;this.contentCarousel=g;this.popoverName=t;this.productCarouselId=l;this.showRelatedProducts=U;this.customerReviewPrefix=m;this.useVerticalLayout=r;this.showVideoVotes=n;this.carouselFramework=
p;this.ospDisclosureLabel=v;this.videoVoteContainerFactory=u;this.prefixes=["","Customer Review: "];this.videoVoteFailure=!1;this.relatedProductsContainerFixedHeight=115;this.useNarrowContainer=!1;this.verticalLightboxMaxWidth=1024;this.segmentHeaderStaticWidth=340;this.carouselFramework=p;this.title=this.wrapper.find(".vse-content-title");this.titlePrefix=this.wrapper.find(".vse-content-title-prefix");this.referenceLink=this.wrapper.find("#vse-customer-review-link");this.activeVideoTitle=this.wrapper.find(".vse-active-video-heading");
this.activeVideoTitlePrefix=this.wrapper.find("#vse-activevideo-crv-prefix");this.activeVideoReferenceLink=this.wrapper.find("#vse-activevideo-crv-link");this.activeVideoVendorName=this.wrapper.find(".vse-video-author");this.activeVideoOspDisclosure=this.wrapper.find(".vse-oap-disclosure");this.activeVideoOspLabel=this.wrapper.find(".vse-oap-label");this.activeVideoOspLink=this.wrapper.find(".vse-oap-link");this.lbVideoCarousel=this.wrapper.find(".vse-related-videos-container");this.lbVideoCarouselContainer=
this.wrapper.find(".vse-lb-right");this.mobileFixedContainer=this.wrapper.find(".vse-lb-left");this.lbHeaderElement=this.wrapper.find(".vse-lb-back-button");this.prefixes[1]=m+": ";this.activeVideoCustomerProfile=this.wrapper.find("#vse-active-video-customer-profile");this.customerProfileContainer=this.wrapper.find(".vse-cp-container");this.narrowContainerSelector=this.wrapper.find(q.narrowContainerSelector);this.wideContainerSelector=this.wrapper.find(q.wideContainerSelector);this.showVideoVotes&&
this.videoVoteContainerFactory&&this.videoVoteContainerFactory.videoVoteConfig&&(this.activeVideoVoteContainer=this.videoVoteContainerFactory.createFromSelector("#vse-video-votes-lb-details-"+this.videoVoteContainerFactory.videoVoteConfig.placementContext));this.activeVideoOspLabel.text(v);this.activeVideoOspLink.attr("href","https://www.amazon.com/ospublishing/onsite-associates/info");var x=this.wrapper.attr("id");this.activeVideoOspLink.click(function(){B.A.trigger("vse:oapDisclosureLink:"+x+":click")});
this.lbContainer=this.wrapper.find(".vse-lb-container");this.lbLeftColumn=this.wrapper.find(".vse-lb-left");this.lbRightColumn=this.wrapper.find(".related-videos-section");this.lbCCHeader=this.wrapper.find(".vse-cc-header");this.lbTabContainer=this.wrapper.find(".vse-lightbox-tab");this.videoAuthor=this.wrapper.find(".vse-video-author span");h.on("resize",function(){a?B.resizeMobileLB():B.resizeDesktopLB()});this.showVideoVotes&&u&&u.videoVoteConfig&&(this.A.on(u.videoVoteConfig.actionPrefix+"-hide-votes",
function(){B.activeVideoVoteContainer.showOrHide(!1,!1,!1,!1);B.videoVoteFailure=!0}),this.A.declarative(u.videoVoteConfig.actionPrefix+"-vote-positive","click",function(){B.castVote(k.POSITIVE_VOTE)}),this.A.declarative(u.videoVoteConfig.actionPrefix+"-vote-negative","click",function(){B.castVote(k.NEGATIVE_VOTE)}))}a.prototype.castVote=function(b){var a=this;if(this.showVideoVotes&&this.videoVoteContainerFactory&&this.videoVoteContainerFactory.videoVoteConfig){var c=this.activeVideoVoteContainer.getPreviousVote(),
h=b===k.POSITIVE_VOTE&&c!=k.POSITIVE_VOTE,c=b===k.NEGATIVE_VOTE&&c!=k.NEGATIVE_VOTE;this.activeVideoVoteContainer.updateWithNewVote(b);this.videoVoteContainerFactory.sendVoteToRemote(h,c,this.activeVideoVoteContainer.getContentId()).then(function(c){a.videoVoteContainerFactory&&a.videoVoteContainerFactory.videoVoteConfig&&a.A.trigger(a.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-cast",b)},function(c){a.activeVideoVoteContainer.updateWithNewVote(b)})}};a.prototype.update=function(b,
a){this.updateActiveVideo(b);this.updateTitle(b,a)};a.prototype.updateActiveVideo=function(b){var a=this,c=this._isCustomerReviewVideo(b),h=this._isOspEnabled(b);this.activeVideoTitle.text(b.title);this.activeVideoVendorName.text(b.vendorName);var e=this.lbVideoCarousel.find('[data-asin\x3d"'+b.contentId+'"]').find(".vse-video-customer-profile");0<e.length?(this.activeVideoCustomerProfile.html(e.clone().removeClass("vse-hidden").html()),this.activeVideoVendorName.addClass("vse-hidden"),this.customerProfileContainer.removeClass("vse-no-cp")):
(this.activeVideoCustomerProfile.html(""),this.activeVideoVendorName.removeClass("vse-hidden"),this.customerProfileContainer.addClass("vse-no-cp"));this.activeVideoTitlePrefix.text(this.prefixes[+c]);this.activeVideoReferenceLink.attr("href",b.referenceUrl||"");this.activeVideoReferenceLink.text(b.title);h?this.activeVideoOspDisclosure.removeClass("vse-hidden"):this.activeVideoOspDisclosure.addClass("vse-hidden");c?(this.activeVideoReferenceLink.text("Customer Review: "+b.title),this.activeVideoTitle.addClass("vse-invisible"),
this.activeVideoReferenceLink.removeClass("vse-invisible")):(this.activeVideoTitle.removeClass("vse-invisible"),this.activeVideoReferenceLink.addClass("vse-invisible"));this.showVideoVotes&&this.videoVoteContainerFactory&&this.videoVoteContainerFactory.videoVoteConfig&&!this.videoVoteFailure&&(this.updateActiveVideoVoteContainer(b.contentId,b.videoVoteContainer.getVoteCount(k.POSITIVE_VOTE),b.videoVoteContainer.getVoteCount(k.NEGATIVE_VOTE),b.videoVoteContainer.countsFetched),this.activeVideoVoteContainer.countsFetched||
this.videoVoteContainerFactory.fetchVoteCounts([b.contentId]).then(function(c){a.videoVoteContainerFactory!==p&&0<c.length&&c[0].contentId===b.contentId&&(a.A.trigger(a.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-counts-fetched",c),a.updateActiveVideoVoteContainer(c[0].contentId,c[0].positiveVoteCount,c[0].negativeVoteCount,!0))},function(b){a.videoVoteContainerFactory!==p&&a.A.trigger(a.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-hide-votes")}),b.videoVoteContainer.getPreviousVote()!==
k.EMPTY_STRING?this.activeVideoVoteContainer.setPreviousVote(b.videoVoteContainer.getPreviousVote()):this.videoVoteContainerFactory.fetchVoteHistory(b.contentId).then(function(b){a.videoVoteContainerFactory===p||b!==k.POSITIVE_VOTE&&b!==k.NEGATIVE_VOTE&&b!==k.NONE_VOTE||(a.activeVideoVoteContainer.setPreviousVote(b),a.A.trigger(a.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-history-set",b))},function(b){}),this.activeVideoVoteContainer.showOrHide(!0,!0,!0,!0));this.useSecondaryView&&this.resizeMobileLB()};
a.prototype.updateActiveVideoVoteContainer=function(b,a,c,h){this.activeVideoVoteContainer.setContentId(b);this.activeVideoVoteContainer.setVoteCount(k.POSITIVE_VOTE,a);this.activeVideoVoteContainer.setVoteCount(k.NEGATIVE_VOTE,c);this.activeVideoVoteContainer.countsFetched=h};a.prototype.updateTitle=function(b,a){this.title=this.$(".vse-content-title");this.title.text(b.title);this.videoAuthor.text(b.vendorName);this.title.attr("title",b.title);this.titlePrefix=this.$(".vse-content-title-prefix");
this.titlePrefix.text(this.prefixes[+this._isCustomerReviewVideo(b)]);a=this._isCustomerReviewVideo(b);this.referenceLink.attr("href",b.referenceUrl||"");this.referenceLink.text(b.referenceLinkTitle||"");a?(this.referenceLink.removeClass("vse-invisible"),this.referenceLink.closest(".vse-video-title").removeClass("vse-no-cr")):(this.referenceLink.addClass("vse-invisible"),this.referenceLink.closest(".vse-video-title").addClass("vse-no-cr"));this.useSecondaryView?this.resizeMobileLB():this.resizeDesktopLB()};
a.prototype.resizeDesktopLB=function(){var b=this.lbLeftColumn.outerHeight(!0),a=b-this.lbCCHeader.outerHeight(!0);this.lbContainer.height(b+this.lbTabContainer.outerHeight(!0));if(!(m.innerWidth<this.verticalLightboxMaxWidth)&&m.innerHeight<this.wrapper.closest(".vse-lightbox-wrapper").outerHeight(!0)){var c=m.innerHeight-this.wrapper.closest(".vse-lightbox-wrapper").outerHeight();this.wrapper.closest(".vse-lightbox-wrapper").animate({marginTop:c/2+"px",marginBottom:c/2+"px"},0)}this.showSegments?
(this.shouldSetProductCarouselWidth(b-this.relatedProductsContainerFixedHeight)?this.narrowContainerSelector.width(this.lbContainer.outerWidth()):this.narrowContainerSelector.removeAttr("style"),this.lbRightColumn.closest(".vse-lb-right").css({"max-height":a}),this.adjustRelatedProductsContainer()):this.lbRightColumn.find(".vse-vertical-scroll").css({"max-height":a});this.$(".vse-lightbox-player-container video").removeClass("dim-video-player")};a.prototype.shouldSetProductCarouselWidth=function(b){return this.wrapper.find(".vse-lb-right .related-videos-section .a-carousel-row").height()<
b?!0:!1};a.prototype.adjustRelatedProductsContainer=function(){this.showCarouselInNarrowContainer();this.useNarrowContainer=!0;this.carouselFramework.initializeAll();this.carouselFramework.createAll()};a.prototype.showCarouselInNarrowContainer=function(){this.A.show(this.narrowContainerSelector);var b=this.findNotHiddenProductCarouselId(q.wideContainerSelector);if(b!==p){var a=b.replace("wide","narrow");this.A.show(this.$("#"+a));this.A.hide(this.$("#"+b))}};a.prototype.findNotHiddenProductCarouselId=
function(b){return this.wrapper.find(b).find(q.activeProductCarousel).not(".aok-hidden").attr("id")};a.prototype._isCustomerReviewVideo=function(b){return"AOD60"==b.vendorCode};a.prototype._isOspEnabled=function(b){return""!=b.vendorTrackingId};a.prototype.resizeMobileLB=function(){var b=this.mobileFixedContainer.height(),a=this.$(m).height()-b;this.lbVideoCarouselContainer.css({"max-height":a,top:b});this.showSegments||this.lbVideoCarousel.css({"max-height":a-this.lbCCHeader.outerHeight(!0)})};a.prototype.attachStickyHeaders=
function(){this.showSegments&&this.contentCarousel.attachStickyHeader({A:this.A,stickyHeaderContainer:"#"+this.popoverName+"-wrapper .vse-lb-right",stickyHeaderLBContainer:"#"+this.popoverName+"-wrapper",lbModalContainer:".a-modal-scroller.a-declarative"})};a.prototype.resetStickyHeaders=function(){this.showSegments&&this.A.$("#"+this.popoverName+"-wrapper .vse-lb-right .vse-vc-header.first-item").removeAttr("style").removeClass("vse-absolute")};return a}(),y=function(){function a(){}a.ELM_OTHER_OPTION=
".vse-fb-other";a.ELM_RBTN_CHECKED='input[name\x3d"FeedbackInput"]:checked';a.ELM_CHECKBOX_CHECKED='input[type\x3d"checkbox"]:checked';a.DATA_REQ_MSG="requiredcommentmessage";a.DATA_OPTIONAL_MSG="optionalcommentmessage";a.ATTR_NAME_PLACEHOLDER="placeholder";return a}(),N=p,O=p;v.when("a-sheet").execute(function(a){N=a});v.when("a-popover").execute(function(a){O=a});var P={getBottomSheet:function(){return N},getPopoverFactory:function(){return O}},ea=function(){function a(b){var a=this;this.config=
b;this.activeVideoSource=this.activeVideo="VIDEO_NOT_SELECTED";this.isOtherSelected=this.registered=!1;this.setBottomSheetHeight=!0;this.internalRejectedVideo=!1;this.defaultBottomSheetHeight=400;this._submitErrorCallback=function(b){a.A.trigger("vse:"+a.id+":feedback:submitted:error")};this._submitSuccessCallback=function(b){a.A.trigger("vse:"+a.id+":feedback:submitted:success")};this.A=b.A;this.pageStateName=b.pageStateName;this.buttonApi=b.buttonApi;this.id=this.config.id;this.A.state.parse();
this.A.state.replace(this.pageStateName,JSON.parse(this.A.$("script[type\x3d'a-state'][data-a-state*\x3d"+this.pageStateName+"]").html()));b=this.A.state(this.pageStateName);this.feedbackSection=this.A.$("#"+this.id);this.feedbackForm=this.A.$("#"+this.id+"-form");this.commentBox=this.A.$("#"+this.id+"-comment-box");this.requiredCommentMessage=this.commentBox.parent().data(y.DATA_REQ_MSG);this.optionalCommentMessage=this.commentBox.parent().data(y.DATA_OPTIONAL_MSG);this.thankYouSection=this.A.$("#"+
this.id+"-ty-container");this.submitButton=this.buttonApi("#"+this.id+"-btn-submit");this.cancelButton=this.A.$("#"+this.id+"-btn-cancel");b&&this.validateFormElements()&&(this.isMobile=b.isMobile,this.endpoint=b.feedbackEndpoint,this.isInternal=b.isInternal,this.marketplaceId=b.marketplaceId,this.pageAsin=b.pageAsin,this.customerId=b.customerId,this.bottomSheetFactory=P.getBottomSheet(),this.popoverFactory=P.getPopoverFactory(),this.registered||(this.A.declarative(this.id+"-options-choose","click",
function(b){a.activeSelectionEvent=b;a.A.$(b)&&a.A.$(b.$target)&&(a.currentViolations=a.A.$(b.$target).closest(".vse-fb-option").find("input").val());a.otherSection=b.$target.closest(y.ELM_OTHER_OPTION);1===a.otherSection.length?(a.updatePlaceholderString(a.requiredCommentMessage),a.isOtherSelected=!0):(a.isOtherSelected=!1,a.updatePlaceholderString(a.optionalCommentMessage));a.submitButton.enable()}),this.A.declarative(this.id+"-andoncord-check","change",function(b){a.internalRejectedVideo=b.$target.is(":checked")}),
this.A.declarative(this.id+"-btn-close","click",function(){return a.closeFeedbackForm()}),this.A.declarative(this.id+"-btn-cancel","click",function(){return a.cancelFeedbackForm()}),this.A.declarative(this.id+"-btn-submit","click",function(){return a.submitFeedback()}),this.A.on("a:sheet:afterShow:"+this.id+"-sheet",function(b){a.defaultBottomSheetHeight=.75*a.A.$(m).height();a.changeBottomSheetHeight(b,a.defaultBottomSheetHeight);a.showFeedbackForm()}),this.A.on("a:sheet:afterHide:"+this.id+"-sheet",
function(b){a.resetFeedbackForm().hideThankYou();a.A.trigger("vse:"+a.id+":feedback:hidden")}),this.A.on("a:popover:afterShow:"+this.id+"-popover",function(b){a.showFeedbackForm()}),this.A.on("a:popover:afterHide:"+this.id+"-popover",function(b){a.hideFeedbackForm()}),this.registered=!0))}a.prototype.showFeedbackForm=function(b){this.A.trigger("vse:"+this.id+":feedback:shown");return this};a.prototype.hideFeedbackForm=function(){this.isMobile?this.getAndSetBottomSheetInstance()&&this.bottomSheetInstance.hide():
this.getAndSetPopoverInstance()&&this.popoverInstance.hide();this.resetFeedbackForm().hideThankYou();this.A.trigger("vse:"+this.id+":feedback:hidden");return this};a.prototype.setActiveVideoAndSource=function(b,a){this.activeVideo=b;this.activeVideoSource=a};a.prototype.submitFeedback=function(){if(this.isOtherSelected&&this.commentBox&&""===this.commentBox.val())this.commentBox.focus();else{var b={events:[{data:{feedback:{additionalComments:this.commentBox?this.commentBox.val():"",playerVersion:"",
asin:this.pageAsin,videoId:this.activeVideo,videoSource:this.activeVideoSource,violations:this.currentViolations,url:document.location.href,userAgent:m.navigator&&m.navigator.userAgent?m.navigator.userAgent:"window.navigator.userAgent not supported",feedbackTime:this.A.now(),customerId:this.customerId,isInternal:this.isInternal,feedbackWidgetVersion:"2",marketplace:this.marketplaceId,internalRejectedVideo:this.internalRejectedVideo}}}]};this.A.$.ajax({url:this.endpoint,data:JSON.stringify(b),type:"POST",
contentType:"application/json; charset\x3dutf-8",error:this._submitErrorCallback,success:this._submitSuccessCallback});this.A.trigger("vse:"+this.id+":feedback:submitted");this.resetFeedbackForm().showThankYou()}};a.prototype.cancelFeedbackForm=function(){this.resetFeedbackForm();this.A.trigger("vse:"+this.id+":feedback:cancelled")};a.prototype.closeFeedbackForm=function(){this.hideFeedbackForm();this.A.trigger("vse:"+this.id+":feedback:closed")};a.prototype.resetFeedbackForm=function(){this.submitButton.disable();
this.feedbackSection.find(y.ELM_RBTN_CHECKED).each(function(){this.checked=!1});this.updatePlaceholderString(this.optionalCommentMessage);this.commentBox.val("");this.internalRejectedVideo=!1;this.feedbackSection.find(y.ELM_CHECKBOX_CHECKED).each(function(){this.checked=!1});return this};a.prototype.showThankYou=function(){this.feedbackForm.fadeOut(200);this.thankYouSection.addClass("show").removeClass("aok-hidden").fadeIn(400);this.A.trigger("vse:"+this.id+":thank-you:shown");return this};a.prototype.hideThankYou=
function(){this.feedbackForm.fadeIn(10);this.thankYouSection.addClass("aok-hidden").removeClass("show").fadeOut(10);this.A.trigger("vse:"+this.id+":thank-you:hidden");return this};a.prototype.validateFormElements=function(){return this.feedbackSection.length&&this.commentBox.length&&this.thankYouSection.length&&this.submitButton.size()&&this.cancelButton.length&&this.feedbackForm.length};a.prototype.updatePlaceholderString=function(b){this.commentBox.attr(y.ATTR_NAME_PLACEHOLDER,b)};a.prototype.changeBottomSheetHeight=
function(b,a){this.setBottomSheetHeight&&(b.sheet.changeHeight({duration:.3,height:a}),this.setBottomSheetHeight=!1)};a.prototype.getAndSetBottomSheetInstance=function(){return this.bottomSheetFactory?this.bottomSheetInstance?this.bottomSheetInstance:this.bottomSheetInstance=this.bottomSheetFactory.get(this.id+"-sheet"):p};a.prototype.getAndSetPopoverInstance=function(){return this.popoverFactory?this.popoverInstance?this.popoverInstance:this.popoverInstance=this.popoverFactory.get(this.id+"-popover"):
p};return a}(),fa=function(){function a(b){this.config=b;this.feedbackWidgets={}}a.prototype.create=function(b,a){a=this.feedbackWidgets[b]||new ea({id:b,pageStateName:a,A:this.config.A,buttonApi:this.config.buttonApi});return this.feedbackWidgets[b]=a};a.prototype.get=function(b){return this.feedbackWidgets[b]};return a}(),ga=function(){function a(b){var a=this;this.config=b;this.playbackCompleteHandler=function(b){return a.onPlaybackComplete(b)};this.playerFullScreenHandler=function(b){return a.onPlayerFullScreen(b)};
this.firstFrameHandler=function(b){return a.onFirstFrame(b)};this.playerLoadedHandler=function(){return a.config.popover.updatePosition()};this.isContinousPlayFinished=this.socialShareIsOpen=this.feedbackIsOpen=this.lightboxPausedVideo=!1;this.lightBoxPopoverClass="vse-lightbox-wrapper";this.shouldSeekVideo=!0;this.seekTime=0;this.isFeedbackCreated=!1;this.relatedProductsNilgiriRequestCount=0;this.refreshSocialSharePageState=function(b,c){if(a.config.showShareWidget){var d=b.$el?b.$el.children(".vse-carousel-item").data("redirect-url"):
"/dp/"+b.contentId;a.config.A.state.replace(c,{pageLevelData:{clientRef:"lb",deviceTypeRef:a.config.isMobile?"mb":"dt"},url:"https://www.amazon.com"+d,image:b.imageUrl,title:b.title,description:b.title})}};var c=b.customerReview,h=b.videoVoteContainerFactory?b.videoVoteContainerFactory:p;this.dom=new da(b.$("#"+b.popoverName+"-wrapper"),!!b.useSecondaryView,b.$,b.A,this.config.showSegments,this.config.contentCarousel,b.popoverName,b.productCarouselId,b.showRelatedProducts,c,b.useVerticalLayout,b.showVideoVotes,
b.carouselFramework,b.ospDisclosureLabel,h);b.mShop&&b.mShopFactory&&(b.mShopFactory.addEventListener("appPause",function(){a.pauseVideoIfNeeded()}),b.mShopFactory.addEventListener("appResume",function(){a.resumeVideoIfNeeded()}));b.$(document).delegate("#"+b.popoverTriggerId,"click",function(a){return a.preventDefault()});b.A.on("a:popover:beforeHide:"+b.popoverName,function(c){a.config.mShop&&a.config.mShopFactory&&a.config.mShopFactory.dispatchEvent({type:"appOverlays.Show"});a.config.showShareWidget&&
(a.socialShareIsOpen&&a.config.A.$("#"+a.config.socialShareId+"-trigger").removeClass("active"),b.A.trigger("vse:socialShare:"+b.socialShareId+"-show-icons:close"));a.dom.resetStickyHeaders();a.config.$("#"+a.config.popoverName+"-wrapper").find(".vse-lb-container").animate({opacity:0});a.hide();a.config.$("body").removeClass("vse-lb-no-scroll");a.config.$("#"+b.popoverName+"-wrapper .vse-lb-right").unbind("scroll")});b.A.on("a:popover:afterShow:"+b.popoverName,function(c){a.config.A.$(c.popover.$popover).addClass("vse-lightbox-wrapper "+
b.A.$("#"+b.popoverName+"-wrapper").data("cssClass"));a.config.mShop&&a.config.$(c.popover.$popover).addClass("vse-lb-mshop");a.isFeedbackCreated||(c=b.flatFeedbackPageContext)&&c.placement&&(a.registerFeedback("vse-ns-feedback-"+c.placement),a.getFeedback(b,1));a.config.isMobile&&a.dom.resizeMobileLB();a.config.mShop&&a.config.mShopFactory?a.config.mShopFactory.dispatchEvent({type:"appOverlays.Hide"}):a.config.A.trigger("resize",{},{width:m.innerWidth,height:m.innerHeight});a.lastScrollTop=b.$(".vse-vertical-scroll").scrollTop();
a.lastTimeScroll=b.A.now();a.config.$("body").addClass("vse-lb-no-scroll");!a.config.isMobile&&a.config.showSegments&&a.config.A.delay(function(){a.dom.resizeDesktopLB();a.dom.attachStickyHeaders()},500);a.config.$("#"+a.config.popoverName+"-wrapper").find(".vse-lb-container").animate({opacity:1},500)});this.config.showShareWidget&&(b.A.declarative(""+b.socialShareActionName,"click",function(a){a.$target.hasClass("active")?b.A.trigger("vse:socialShare:"+b.socialShareId+"-show-icons:close"):b.A.trigger("vse:socialShare:"+
b.socialShareId+"-show-icons:show");a.$target.toggleClass("active")}),this.registerSocialShare(b));if(b.displayCarousel)b.A.on("vse:contentCarousel:"+b.carouselConfig.carouselName+":click",function(b){a.refreshSocialSharePageState(b,a.config.socialSharePageStateName);a.getPlayer(b).play(b);a.show(b)});b.A.on("vse:oapDisclosureLink:"+b.popoverName+"-wrapper:click",function(){a.pauseVideoIfNeeded()})}a.prototype.onFirstFrame=function(a){this.shouldSeekVideo&&(this.getPlayer(a).setCurrentTime(this.seekTime),
this.shouldSeekVideo=!1);this.config.isMobile&&this.hideFeedbackLink("#"+this.config.popoverName+"-feedback-container",".vse-lightbox-player-container video")};a.prototype.startPlaying=function(a,c){this.isContinousPlayFinished=!1;this.getPlayer(a);this.config.popover.show();this.show(a);this.config.autoplay?(this.seekTime=c,this.getPlayer(a).unmute(),this.getPlayer(a).play(a)):!this.config.mShop&&this.config.useSecondaryView||this.getPlayer(a).play(a);this.config.contentCarousel.changeStartingCardTo(a);
return this};a.prototype.show=function(a){var c=this;this.activeASIN=a.contentId;this.activeVideoAsset=a;this.config.contentCarousel.rotateTo(a);this.dom.update(a,this.config.contentTitle);this.setFeedbackActiveVideoAndSource(a);this.config.showRelatedProducts&&(this.showRelatedProducts(a),this.config.A.$("#"+this.config.popoverName+"-wrapper").delegate(".vse-product-item a","click",function(a){a.stopPropagation();a.stopImmediatePropagation();c.pauseVideoIfNeeded()}),this.config.relatedProductsComponentConfig&&
this.config.relatedProductsComponentConfig.features&&this.config.relatedProductsComponentConfig.features.features&&(a=this.config.relatedProductsComponentConfig.features.features.carouselName,this.config.A.off("vse:productCarousel:"+a+":init"),this.config.A.on("vse:productCarousel:"+a+":init",function(){c.config.A.$("#"+(c.config.popoverName+"-"+q.visibleDivNarrowPrefix+c.activeASIN)+" .vse-related-product-container").animate({opacity:1},200)})));return this};a.prototype.showRelatedProducts=function(a){this.fadeOutRelatedProductsContainer();
var c=a.relatedProducts;""!==c?this.retrieveRelatedProductsCarouselFromCache(a.contentId)!==p?this.getRelatedProductsFromCache(a.contentId):this.getRelatedProducts(this.config,1,c,a.contentId):this.config.isMobile&&(this.config.A.hide(this.config.A.$(q.narrowContainerMobileSelector)),this.dom.resizeMobileLB())};a.prototype.getRelatedProducts=function(a,c,d,h){var e=this;if(3<c)this.handleGetRelatedProductsFailure();else{var g=!0;0<this.relatedProductsNilgiriRequestCount&&(g=!1);var t=a.relatedProductsComponentConfig,
l=a.relatedProductsPageContext;if(t&&l&&t.features&&t.features.features){var k=t.features;F.sendRequest(this.config.A,"/vap/ew/subcomponent/relatedproducts",{pageContext:{page:l.page,placement:l.placement,marketplaceID:l.marketplaceID,locale:l.locale,customerId:l.customerId,requestId:l.requestId,product:{contentID:a.pageAsin,contentIDType:"ASIN"},metadata:{relatedProductsAsins:d}},configuration:{id:t.id,type:t.type,binder:t.binder,assets:g?["ProductCarousel"]:[],features:{features:{context:k.features.context,
displayStrategy:k.features.displayStrategy,pagestate:k.features.pagestate,explicitlyEmitPageState:k.features.explicitlyEmitPageState,cssClass:k.features.cssClass,carouselName:k.features.carouselName}}}},function(a){-1!==a.indexOf("vse-related-product-container")?(e.cacheRelatedProductsPayload(h,a),e.handleGetRelatedProductsSuccess(h),u.count("rvp:videolightbox:relatedproducts:load:success:",1),e.relatedProductsNilgiriRequestCount+=1):e.handleGetRelatedProductsFailure()},function(a){c+=1;e.getRelatedProducts(e.config,
c,d,h)})}}};a.prototype.cacheRelatedProductsPayload=function(a,c){a=this.config.popoverName+"-vse-pc-hidden-cache-"+a;this.config.A.$(q.cacheRelatedProductsPayloadHiddenDivId).append("\x3cdiv id\x3d'"+a+"'\x3e"+c+" \x3c/div\x3e")};a.prototype.retrieveRelatedProductsCarouselFromCache=function(a){a=this.config.A.$("#"+this.config.popoverName+"-vse-pc-hidden-cache-"+a+" .vse-related-product-container");if(a!==p&&a[0]!==p)return a[0].outerHTML};a.prototype.handleGetRelatedProductsSuccess=function(a){var c=
this.retrieveRelatedProductsCarouselFromCache(a);this.hideCurrentlyVisibleProductContainer(a);var d=this.config.popoverName+"-"+q.visibleDivNarrowPrefix+a,h=this.config.popoverName+"-"+q.visibleDivWidePrefix+a;this.config.isMobile?this.appendProductCarouselHTML(q.narrowContainerMobileSelector,d,c):(this.appendProductCarouselHTML(q.narrowContainerSelector,d,c),this.appendProductCarouselHTML(q.wideContainerSelector,h,c));this.showRelatedProductCarousel(a);this.fadeInRelatedProductsContainer();this.config.isMobile&&
this.dom.resizeMobileLB()};a.prototype.appendProductCarouselHTML=function(a,c,d){this.config.A.$("#"+this.config.popoverName+"-wrapper "+a).append('\x3cdiv class\x3d"vse-pc-visible aok-hidden" id\x3d\''+c+"'\x3e"+d+"\x3c/div\x3e")};a.prototype.getRelatedProductsFromCache=function(a){this.hideCurrentlyVisibleProductContainer(a);this.showRelatedProductCarousel(a);this.fadeInRelatedProductsContainer();this.config.isMobile&&this.dom.resizeMobileLB()};a.prototype.hideCurrentlyVisibleProductContainer=function(a){this.config.A.$("[id^\x3dvse-related-products-]").find(".vse-pc-visible").addClass("aok-hidden")};
a.prototype.showRelatedProductCarousel=function(a){a=this.config.popoverName+"-"+q.visibleDivNarrowPrefix+a;this.config.isMobile?(this.config.A.show(this.config.A.$(q.narrowContainerMobileSelector)),this.showIndividualProductCarousel(q.narrowContainerMobileSelector,a)):this.showIndividualProductCarousel(q.narrowContainerSelector,a);this.config.carouselFramework.createAll()};a.prototype.showIndividualProductCarousel=function(a,c){this.config.A.$("#"+c).removeClass("aok-hidden")};a.prototype.handleGetRelatedProductsFailure=
function(){u.count("rvp:videolightbox:relatedproducts:load:failed",1);this.config.A.$(q.relatedProductsInnerContainer).hide();this.config.isMobile&&(this.config.A.hide(this.config.A.$(q.narrowContainerMobileSelector)),this.dom.resizeMobileLB())};a.prototype.fadeOutRelatedProductsContainer=function(){this.config.A.$(q.relatedProductsInnerContainer).fadeOut(200)};a.prototype.fadeInRelatedProductsContainer=function(){this.config.A.$(q.relatedProductsInnerContainer).fadeIn(800)};a.prototype.createPlaylist=
function(a){this.playlist=a;return this};a.prototype.getCarousel=function(){return this.config.contentCarousel};a.prototype.hide=function(){this.destroyPlayer();this.config.popover.hide();this.config.$("body").removeClass("vse-lb-sc");return this};a.prototype.handleFailFullScreen=function(){this.dom.resizeMobileLB()};a.prototype.hideIfPossible=function(){0==this.feedbackIsOpen&&1==this.isContinousPlayFinished&&this.hide()};a.prototype.updateVotingElements=function(a,c){this.config.contentCarousel.updateVotingElements(a,
c);c=this.activeASIN;for(var d,h=0;h<a.length;h++)if(a[h].contentId===c){d=a[h].positiveVoteCount;a=a[h].negativeVoteCount;this.dom.updateActiveVideoVoteContainer(c,d,a,!0);break}return this};a.prototype.getNextAsset=function(a){for(var c=0;c<this.playlist.length&&this.playlist[c].contentId!=a.contentId;c++);if(c!=this.playlist.length)return this.playlist[c+1]};a.prototype.pauseVideoIfNeeded=function(){this.player&&this.player.isPlaying()&&(this.player.pause(),this.lightboxPausedVideo=!0)};a.prototype.resumeVideoIfNeeded=
function(){this.player&&!this.player.isPlaying()&&!this.isContinousPlayFinished&&this.lightboxPausedVideo&&this.player.resume(Date.now());this.lightboxPausedVideo=!1};a.prototype.getPlayer=function(a){this.player||(this.config.autoplay&&(this.config.playerConfig.shouldStartMuted=!0),a.eventTimestamp&&(this.config.playerConfig.eventTimestamp=a.eventTimestamp),a.refTag&&(this.config.playerConfig.refTag=a.refTag),this.config.playerConfig.initialVideo=a,this.player=this.config.awaFactory.create(this.config.playerConfig),
this.player.on("playbackComplete",this.playbackCompleteHandler),this.player.on("playerLoaded",this.playerLoadedHandler),this.player.on("playerFullScreen",this.playerFullScreenHandler),this.player.on("playbackStart",this.firstFrameHandler));return this.player};a.prototype.destroyPlayer=function(){if(this.player){var a=this.player;this.player=null;a.off("playbackComplete",this.playbackCompleteHandler);a.off("playerLoaded",this.playerLoadedHandler);a.off("playerFullScreen",this.playerFullScreenHandler);
a.off("playbackStart",this.firstFrameHandler);this.shouldSeekVideo=!0;a.destroy();null==this.player}};a.prototype.onPlaybackComplete=function(a){var c=this.getNextAsset(a);c?(this.refreshSocialSharePageState(c,this.config.socialSharePageStateName),a.eventTimestamp&&(c.eventTimestamp=a.eventTimestamp),this.player.play(c),this.show(c)):(this.isContinousPlayFinished=!0,this.hideIfPossible())};a.prototype.onPlayerFullScreen=function(a){var c=this.config.$("#"+this.config.popoverName+"-wrapper"),d=this.config.$("."+
this.lightBoxPopoverClass);c&&(a?(c.addClass("vse-player-fullscreen"),d.addClass("vse-lb-fullscreen")):(c.removeClass("vse-player-fullscreen"),d.removeClass("vse-lb-fullscreen")))};a.prototype.deRegisterFeedback=function(a){this.config.A.off("vse:"+a+":feedback:shown");this.config.A.off("vse:"+a+":feedback:hidden");this.config.A.off("vse:ns:feedback:"+a+":init:client")};a.prototype.registerFeedback=function(a){var c=this;this.config.A.on("vse:ns:feedback:"+a+":init:client",function(){var l=new fa({A:c.config.A,
buttonApi:c.config.buttonApi}),k=z.fetchLatestPageState(c.config.A,a);k&&(k=k.id,c.deRegisterFeedback(k),c.config.A.on("vse:"+k+":feedback:shown",function(){c.pauseVideoIfNeeded();h=!1}),c.config.A.on("vse:"+k+":feedback:hidden",function(){c.resumeVideoIfNeeded();h=!0;e||c.hideFeedbackLink(d,g+" video")}),c.config.A.on("vse:"+k+":feedback:hidden",function(){c.config.mShop&&c.config.mShopFactory&&c.config.A.delay(function(){c.config.mShopFactory.dispatchEvent({type:"appOverlays.Hide"})},500)}),c.feedback=
l.create(k,a),c.setFeedbackActiveVideoAndSource(c.activeVideoAsset))});var d="#"+this.config.popoverName+"-feedback-container",h=!0,e=!1,g=".vse-lightbox-player-container";this.config.A.declarative.create(this.config.A.$(g),"feedback-overlays-player",{});this.config.A.declarative("feedback-overlays-player","mouseenter touchstart focus",function(a){(h||c.config.isMobile)&&c.showFeedbackLink(d,g+" video");e=!0});this.config.A.declarative("feedback-overlays-player","mouseleave",function(a){(h||c.config.isMobile)&&
c.hideFeedbackLink(d,g+" video");e=!1})};a.prototype.showFeedbackLink=function(a,c){this.config.A.$(a).css({display:"inline-block"});this.config.A.$(c).addClass("dim-video-player")};a.prototype.hideFeedbackLink=function(a,c){this.config.A.$(a).css({display:"none"});this.config.A.$(c).removeClass("dim-video-player")};a.prototype.deRegisterSocialShare=function(a){a.A.off("vse:socialShare:"+a.socialShareId+"-show-icons:show");a.A.off("vse:socialShare:"+a.socialShareId+"-show-icons:close")};a.prototype.registerSocialShare=
function(a){var c=this;this.deRegisterSocialShare(a);a.A.on("vse:socialShare:"+a.socialShareId+"-show-icons:show",function(){c.socialShareIsOpen=!0});a.A.on("vse:socialShare:"+a.socialShareId+"-show-icons:close",function(){c.socialShareIsOpen=!1})};a.prototype._adjustLightbox=function(){this.dom.resizeMobileLB()};a.prototype.setFeedbackActiveVideoAndSource=function(a){this.isFeedbackCreated&&a&&this.feedback.setActiveVideoAndSource(a.contentId,a.vendorCode)};a.prototype.getFeedback=function(a,c){var d=
this;if(3<c)u.count("rvp:videolightbox:feedback:load:failed",1);else{var h=a.flatFeedbackComponentConfig,e=h.features,g=a.flatFeedbackPageContext;F.sendRequest(this.config.A,"/vap/ew/subcomponent/feedback",{pageContext:{page:g.page,placement:g.placement,marketplaceID:g.marketplaceID,locale:g.locale,customerId:g.customerId,requestId:g.requestId,product:{contentID:a.pageAsin,contentIDType:"ASIN"}},configuration:{id:h.id,type:h.type,binder:h.binder,features:{features:{infringementUrl:e.features.infringementUrl,
endpoint:e.features.endpoint,reftagprefix:e.features.reftagprefix,context:e.features.context}}}},function(a){d.config.A.$("#"+d.config.popoverName+"-feedback-container").html(a);d.isFeedbackCreated=!0;u.count("rvp:videolightbox:feedback:load:success:",1)},function(){c+=1;d.getFeedback(a,c)})}};return a}(),ha=function(){function a(){}a.prototype.markPlaying=function(a){};a.prototype.rotateTo=function(a){};a.prototype.changeStartingCardTo=function(a){};a.prototype.getplaylist=function(){return[]};a.prototype.getActiveAsset=
function(){return{}};a.prototype.findIndex=function(a){return-1};a.prototype.destroy=function(){};a.prototype.emitRefTag=function(a,c){};a.prototype.updateVotingElements=function(a,c){};a.prototype.attachStickyHeader=function(a){};return a}(),Q=null;v.when("mash").execute(function(a){Q=a});var ia={getMash:function(){return Q}},ja=function(){return function(a){this.message=a}}(),R=function(){function a(a){this.constructorConfig=a}a.prototype.create=function(a){var c=this.constructorConfig.modalFactory.get(this.constructorConfig.$("#"+
a.popoverTriggerId)),d=a.mShop?ia.getMash():null,h=this.constructorConfig.videoVoteContainerFactory?this.constructorConfig.videoVoteContainerFactory:p;if(!c)throw new ja("Cannot create popover using name "+a.popoverName);var e=a.displayCarousel?this.constructorConfig.contentCarouselFactory.create(a.carouselConfig):new ha;return new ga({popoverName:a.popoverName,popoverTriggerId:a.popoverTriggerId,playerConfig:a.playerConfig,displayCarousel:a.displayCarousel,carouselConfig:a.carouselConfig,contentTitle:a.contentTitle,
useSecondaryView:a.useSecondaryView,displayActiveVideoDetails:a.displayActiveVideoDetails,popover:c,$:this.constructorConfig.$,contentCarousel:e,mShopFactory:d,buttonApi:this.constructorConfig.buttonApi,pageAsin:a.pageAsin,flatFeedbackComponentConfig:a.flatFeedbackComponentConfig,flatFeedbackPageContext:a.flatFeedbackPageContext,productCarouselId:a.productCarouselId,awaFactory:this.constructorConfig.awaFactory,mShop:a.mShop,A:this.constructorConfig.A,feedbackEndpoint:a.feedbackEndpoint,showProductCarousel:a.showProductCarousel,
recordProductMetrics:a.recordProductMetrics,featProductsUrl:a.featProductsUrl,showShareWidget:a.showShareWidget,socialShareId:a.socialShareId,socialShareActionName:a.socialShareActionName,isMobile:a.isMobile,autoplay:a.autoplay,customerReview:a.customerReview,useVerticalLayout:a.useVerticalLayout,videoVoteContainerFactory:h,showVideoVotes:a.showVideoVotes,relatedProductsComponentConfig:a.relatedProductsComponentConfig,relatedProductsPageContext:a.relatedProductsPageContext,showRelatedProducts:a.showRelatedProducts,
carouselFramework:this.constructorConfig.carouselFramework,showSegments:a.showSegments,ospDisclosureLabel:a.ospDisclosureLabel,socialSharePageStateName:a.socialSharePageStateName})};return a}(),l=function(){function a(){}a.INSTANCE="vse:rvs";a.METRIC_TIME_TO_REGISTERED="vse:csm:vse-rel-videos-carousel:loadedAndRegistered:time";a.METRIC_TIME_TO_NOT_REGISTERED="vse:csm:vse-rel-videos-carousel:loadedNotRegistered:time";a.METRIC_INIT_CLIENT=a.INSTANCE+":init-client";a.METRIC_INIT_CLIENT_WAITING=a.INSTANCE+
":init-client:waiting";a.METRIC_INIT_CLIENT_PLAYERS=a.INSTANCE+":init-client:players";a.METRIC_PAGE_VIEW=a.INSTANCE+":page:view";a.METRIC_WIDGET_CLICK=a.INSTANCE+":widget:click";a.VIEWABLE_SECONDS=2;a.METRIC_PAGE_VIEW_MA=a.INSTANCE+":ma:page:view";a.METRIC_WIDGET_CLICK_MA=a.INSTANCE+":ma:widget:click";a.METRIC_VIDEO_VIEWABLE=a.INSTANCE+":ma:viewable";a.METRIC_VIDEO_VIEWABLE_X=a.INSTANCE+":ma:viewable:x";a.METRIC_WIDGET_VIEW=a.INSTANCE+":ma:widget:view";a.METRIC_WIDGET_SWIPE=a.INSTANCE+":ma:widget:swipe";
a.METRIC_SCROLL_PTFF=a.INSTANCE+":ma:scroll:ptff";a.METRIC_SWIPE_PTFF=a.INSTANCE+":ma:swipe:ptff";a.SLOT_NUMBERS=["one","two","three","four"];a.METRIC_PLAYER_ASYNCHRONOUS_ERROR=a.INSTANCE+":ma:error";a.PLAYER_CONTAINER_ID_PREFIX="vse-rvs-ingress-player-";a.muteButtonSrc="https://m.media-amazon.com/images/G/01/vse/Discovery/mute._CB474746454_.png";a.unmuteButtonSrc="https://m.media-amazon.com/images/G/01/vse/Discovery/unmute._CB474746442_.png";a.EMPTY_STRING="";a.socialSharePageStateName="vse-rvp-social-share";
a.socialShareClickMetricName="vseSocialShareClickRvs";return a}(),c={variables:{A:{},lightbox:null,lightboxCarousel:null,ingressCarousel:null,RVA_SUSHI_URL:l.EMPTY_STRING,buildMetricPayload:{},buildUniversalSushiPayload:{},sushiMetricsConfig:null,isVerticalScroll:!0,playHeadPosition:-1,playList:[],playStartTime:-1,rvaVideoViewRecorded:!1,rvaViewTimeoutId:-1,shouldMute:!0,universalSushiEndpoint:l.EMPTY_STRING,vsePlayerList:[],vsePlayerState:[],wasCarouselInView:!1,showVideoVotes:!1,videoVoteContainerFactory:null,
libs:{}},BrilaFactory:J,GatedP:G,PostMetric:u,MetricUtils:C,AuiUtils:z,VoteData:K,VideoVoteContainer:D,VideoVoteContainerFactory:H,EventEmitter:M,VideoLightboxFactory:R,makeApplicationSushiPayloadBuilder:C.makeApplicationSushiPayloadBuilder,emitMetric:function(a,b){if(m.ue)try{m.ue.count(a,b)}catch(f){c.logError(f,"vse-related-video-shorts-metrics","Failed to log CSM level metric.")}},emitSushiMetric:function(a,b){a=c.variables.buildUniversalSushiPayload({eventName:a,stringPayload:l.EMPTY_STRING,
intPayload:b});u.emitSushiMetric(a,c.variables.universalSushiEndpoint)},emitThumbnailMetric:function(a,b){a=c.variables.buildUniversalSushiPayload({eventName:a,stringPayload:l.EMPTY_STRING,intPayload:b,videoAsin:c.variables.playList[b].contentId});u.emitSushiMetric(a,c.variables.universalSushiEndpoint)},emitThumbnailRenderMetric:function(a,b){a=c.variables.buildUniversalSushiPayload({eventName:a,stringPayload:l.EMPTY_STRING,intPayload:b,videoAsinList:c.variables.playList.map(function(a){return a.contentId}).join(",")});
u.emitSushiMetric(a,c.variables.universalSushiEndpoint)},emitViewableView:function(a){if(!(0>c.variables.playHeadPosition)){var b=c.variables.vsePlayerList[a].getPosition()-c.variables.playHeadPosition;c.variables.playHeadPosition=-1;b>=l.VIEWABLE_SECONDS&&(c.emitMetric(l.METRIC_VIDEO_VIEWABLE,1),0<=a&&a<l.SLOT_NUMBERS.length?c.emitMetric(l.METRIC_VIDEO_VIEWABLE+":"+l.SLOT_NUMBERS[a],1):c.emitMetric(l.METRIC_VIDEO_VIEWABLE_X,1))}},findContentId:function(a,b){var f=null;c.variables.A.each(a,function(a){a.contentId===
b&&(f=a)});return f},isDefined:function(a){return"undefined"!==typeof a&&null!==a},mutedPause:function(a){if(!c.variables.vsePlayerState[a])return c.variables;try{c.variables.vsePlayerList[a].pause(),c.variables.vsePlayerState[a]=!1,c.emitViewableView(a)}catch(b){c.emitMetric(l.METRIC_PLAYER_ASYNCHRONOUS_ERROR,1)}},mutedPlay:function(a){if(c.variables.vsePlayerState[a])return c.variables;var b=c.variables.vsePlayerList[a];c.variables.vsePlayerState[a]=!0;c.variables.playHeadPosition=b.getPosition();
c.variables.playStartTime=Date.now();b.play()},setPlayerState:function(a){c.variables.vsePlayerState[a]=!1},isScrolledIntoView:function(a,b){var c=a.$(m);a=c.scrollTop();var c=a+c.height(),d=b.offset().top+.4*b.height();return b.offset().top+.6*b.height()<=c&&d>=a},makeMetricPayloadBuilder:function(a){return function(b){b.sessionId=a.sessionId;b.requestId=a.requestId;b.customerId=a.customerId;b.marketplaceId=a.marketplaceId;b.pageAsin=a.pageAsin;b.timestamp=new Date;return{events:[{data:b}]}}},registerClientEventOnce:function(a,
b,f,d,h,e){e.clickHandle&&a.off(e.clickHandle);e.closeHandle&&a.off(e.closeHandle);e.videoVoteCastHandle&&a.off(e.videoVoteCastHandle);e.videoVoteHistoryHandle&&a.off(e.videoVoteHistoryHandle);e.videoVoteCountHandle&&a.off(e.videoVoteCountHandle);e.closeHandle=a.on("a:popover:beforeHide:"+f.popoverName,function(a){h.destroy()});e.clickHandle=a.on("vse:contentCarousel:"+b.carouselName+":click",function(g){for(var e=d.getCarousel().getplaylist(),h=0,k=0;k<e.length;k++){if(e[0].contentId===g.contentId){b.autoplay&&
"undefined"!==typeof c.variables.vsePlayerList[k]&&(c.mutedPause(k),c.variables.wasCarouselInView=!1,h=c.variables.vsePlayerList[k].getCurrentTime());break}e.push(e.shift())}k=C.makeApplicationSushiPayloadBuilder(c.variables.A,c.variables.sushiMetricsConfig);if(f.showShareWidget){var m=g.$el?g.$el.children(".vse-carousel-item").data("redirect-url"):"/dp/"+g.contentId;a.state.replace("vse-rvp-social-share",{pageLevelData:{clientRef:"lb",deviceTypeRef:f.isMobile?"mb":"dt"},url:"https://www.amazon.com"+
m,image:g.imageUrl,title:g.title,description:g.title})}c.emitMetric(l.METRIC_WIDGET_CLICK,1);c.variables.universalSushiEndpoint!==l.EMPTY_STRING&&(k=k({eventName:"rvs.widgetClick",stringPayload:l.EMPTY_STRING,intPayload:1}),u.emitSushiMetric(k,c.variables.universalSushiEndpoint));b.autoplayTriggered&&c.emitMetric(l.METRIC_WIDGET_CLICK_MA,1);d.createPlaylist(e);d.startPlaying(g,h)});c.variables.showVideoVotes&&c.variables.videoVoteContainerFactory&&c.variables.videoVoteContainerFactory.videoVoteConfig&&
(e.videoVoteCastHandle=a.on(c.variables.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-cast",function(a){var b=a===k.POSITIVE_VOTE?k.NEGATIVE_VOTE:k.POSITIVE_VOTE,e=c.ingressCarousel.getActiveAsset().contentId,f=c.findContentId(c.ingressCarousel.getplaylist(),e),h=c.findContentId(d.getCarousel().getplaylist(),e),b=f&&f.videoVoteContainer.getPreviousVote()===a?"cancel:"+a:!f||f.videoVoteContainer.getPreviousVote()!==k.POSITIVE_VOTE&&f.videoVoteContainer.getPreviousVote()!==k.NEGATIVE_VOTE?
a:"switch-"+b+"-to-"+a;null!==f&&f.videoVoteContainer.updateWithNewVote(a);null!==h&&h.videoVoteContainer.updateWithNewVote(a);c.variables.universalSushiEndpoint!==l.EMPTY_STRING&&(a=c.variables.buildUniversalSushiPayload({eventName:"rvs.videovote.castvote:"+b,stringPayload:l.EMPTY_STRING,intPayload:1,videoAsin:e}),u.emitSushiMetric(a,c.variables.universalSushiEndpoint))}),e.videoVoteHistoryHandle=a.on(c.variables.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-history-set",function(a){var b=
d.getCarousel().getActiveAsset().contentId,e=c.findContentId(c.ingressCarousel.getplaylist(),b),b=c.findContentId(d.getCarousel().getplaylist(),b);e&&e.videoVoteContainer.setPreviousVote(a);b&&b.videoVoteContainer.setPreviousVote(a)}),e.videoVoteCountHandle=a.on(c.variables.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-counts-fetched",function(a){c.ingressCarousel.updateVotingElements(a,!1);c.lightbox.updateVotingElements(a,!1)}));return e},beginTrackingRvaViewTimer:function(){var a=c.variables.vsePlayerList[0].getPosition();
a>=l.VIEWABLE_SECONDS?(c.variables.sushiMetricsConfig&&c.variables.sushiMetricsConfig.hasOwnProperty("endpoint")&&(a=c.variables.buildMetricPayload({videoAsin:c.variables.playList[0].contentId,name:"vse.related_video_advertising.videoView"}),u.emitSushiMetric(a,c.variables.RVA_SUSHI_URL)),c.variables.rvaViewTimeoutId=-1,c.variables.rvaVideoViewRecorded=!0):c.variables.rvaViewTimeoutId=c.variables.A.delay(c.beginTrackingRvaViewTimer,1E3*(l.VIEWABLE_SECONDS-a))},verticalScrollHandler:function(a,b,f){"undefined"!==
typeof b&&(c.isScrolledIntoView(a,b)?(c.variables.wasCarouselInView||c.emitMetric(l.METRIC_WIDGET_VIEW,1),c.variables.wasCarouselInView=!0,c.variables.isVerticalScroll=!0,c.mutedPlay(f),-1!==c.variables.rvaViewTimeoutId||c.variables.rvaVideoViewRecorded||(c.variables.rvaViewTimeoutId=a.delay(c.beginTrackingRvaViewTimer,1E3*(l.VIEWABLE_SECONDS-c.variables.vsePlayerList[0].getPosition())))):(c.variables.wasCarouselInView=!1,c.mutedPause(f),-1!==c.variables.rvaViewTimeoutId&&(clearTimeout(c.variables.rvaViewTimeoutId),
c.variables.rvaViewTimeoutId=-1)))},firstFrameHandler:function(){if(!(0>c.variables.playStartTime)){var a=c.variables.isVerticalScroll?l.METRIC_SCROLL_PTFF:l.METRIC_SWIPE_PTFF,b=Date.now()-c.variables.playStartTime;c.emitMetric(a,b);c.variables.isVerticalScroll=!1;c.variables.playStartTime=-1}},createPlayer:function(a,b,f,d,h){var e=a.$.extend({},d),g=c.variables.shouldMute?l.muteButtonSrc:l.unmuteButtonSrc;d=a.$.extend({},d.videoAds);var k=b[f];b=l.PLAYER_CONTAINER_ID_PREFIX+(f+1);var m=c.makeMetricPayloadBuilder(c.variables.sushiMetricsConfig);
e.requestMetadata.method=e.requestMetadata.method.replace("vse_lb","vse_rva");e.initialVideo=k;e.containerId=b;e.shouldStartMuted=c.variables.shouldMute;e.shouldDisableControls=!0;e.airyVersion="VideoJS";e.videoAds=d;e.videoAds.isEngineEnabled=!1;a.$("#"+b).find("img").hide();a.$("#"+b).find("p").hide();c.variables.vsePlayerList[f]=h.create(e);c.variables.vsePlayerList[f].on("playbackStart",c.firstFrameHandler);c.variables.vsePlayerList[f].on("playbackComplete",function(a){c.setPlayerState(f)});a.$("#"+
b+"-container").wrap('\x3cdiv class\x3d"vse-rvs-autoplay-container"\x3e\x3c/div\x3e');a.$("#"+b+"-container").after("\x3cdiv class \x3d 'vse-rvp-overlap-player'\x3e\x3c/div\x3e\x3cimg class\x3d'vse-rvp-mutebutton' src\x3d"+g+" /\x3e");a.$("#"+b).find(".vse-rvp-overlap-player").bind("click",function(a){c.variables.sushiMetricsConfig&&c.variables.sushiMetricsConfig.hasOwnProperty("endpoint")&&(a=m({videoAsin:k.contentId,name:"vse.related_video_advertising.videoClick"}),u.emitSushiMetric(a,c.variables.RVA_SUSHI_URL))});
a.$("#"+b).find(".vse-rvp-mutebutton").bind("click",function(b){b.stopPropagation();b.preventDefault();b=0;for(var d=c.variables.vsePlayerList;b<d.length;b++){var e=d[b];if("undefined"===typeof e)break;e.isMuted()?(c.variables.shouldMute=!1,a.$(".vse-rvp-mutebutton").attr("src",l.unmuteButtonSrc),e.unmute(),c.variables.sushiMetricsConfig&&c.variables.sushiMetricsConfig.hasOwnProperty("endpoint")&&(e=m({name:"vse.related_video_advertising.unmuteClick",videoAsin:k.contentId}),u.emitSushiMetric(e,c.variables.RVA_SUSHI_URL))):
(c.variables.shouldMute=!0,a.$(".vse-rvp-mutebutton").attr("src",l.muteButtonSrc),e.mute())}})},AutoPlayInitialization:function(a,b,f,d){for(var h=a.now(),e=0;e<Math.min(2,c.variables.playList.length);e++)c.createPlayer(a,c.variables.playList,e,f,d);c.variables.vsePlayerList[0].on("playbackComplete",function(b){c.mutedPlay(0);c.variables.rvaVideoViewRecorded=!1;a.delay(c.beginTrackingRvaViewTimer,l.VIEWABLE_SECONDS)});var g=0,k=0;a.on("a:carousel:"+b.carouselName+":updatePageIndex",function(a,b){g=
k;k=(a-1)*b});a.$(m).unload(function(){c.emitViewableView(k)});var q=a.$("#vse-rvs-ingress-player-1");a.on("a:carousel:"+b.carouselName+":scrollCarousel",function(b,e){g=k;k=(b-1)*e;if(c.isScrolledIntoView(a,q)){c.mutedPause(g);if(k>g)for(b=0;2>=b;b++)e=k+b,e<c.variables.playList.length&&"undefined"===typeof c.variables.vsePlayerList[e]&&c.createPlayer(a,c.variables.playList,e,f,d);c.emitMetric(l.METRIC_WIDGET_SWIPE,1);c.mutedPlay(k)}});a.on("vse:rva:carousel:"+b.carouselName+":productClick",function(a){c.variables.sushiMetricsConfig&&
c.variables.sushiMetricsConfig.hasOwnProperty("endpoint")&&(a=c.variables.buildMetricPayload(a),u.emitSushiMetric(a,c.variables.RVA_SUSHI_URL))});c.variables.vsePlayerList[k].on("playerLoaded",function(b){c.verticalScrollHandler(a,q,k)});c.verticalScrollHandler(a,q,k);a.on.scroll(function(){c.verticalScrollHandler(a,q,k)});c.emitMetric(l.METRIC_INIT_CLIENT_PLAYERS,a.now()-h)},log:function(a,b,c,d){m.ueLogError&&m.ueLogError(b,{logLevel:a,attribution:c,message:d})},logFatal:function(a,b,f){c.log("FATAL",
a,b,f)},logError:function(a,b,f){c.log("ERROR",a,b,f)},getMshopShareParams:function(a,b){a=c.constructShareBaseUrl()+a;b=b+" "+a;var f="\x3cdiv\x3e \x3cp\x3e"+b+"\x3c/p\x3e \x3c/div\x3e";return{subject:b,messagePlain160:b.substring(0,160),messagePlain140:b.substring(0,140),messageHTML:f,messagePlain:b,url:a}},constructShareBaseUrl:function(){return(c.isDefined(m.location.origin)?m.location.origin:"https://www.amazon.com")+"/vdp/"}},S=1,la=function(a){return new a(function(a,f){v.when("A").register("VSE-RVS-client",
function(d){var f={clickHandle:null,closeHandle:null,videoVoteCastHandle:null,videoVoteHistoryHandle:null,videoVoteCountHandle:null};c.variables.A=d;var e=0,g=0,k=0,m=!1,q=function(){var a=c.variables.A.$("#vse-related-videos");if(m||!c.isDefined(a.offset()))c.variables.A.off("scroll",q);else if(c.isScrolledIntoView(c.variables.A,a)){c.emitSushiMetric("rvs.pageView",1);e=Math.min(c.ingressCarousel.carouselPageSize,c.variables.playList.length);g=c.ingressCarousel.carouselPageNumber+1;k=c.ingressCarousel.auiCarousel.getAttr("totalPages");
for(a=0;a<e;a++)c.emitThumbnailMetric("rvs.thumbnailImpression",a);e!=c.variables.playList.length&&(c.variables.A.on("a:carousel:"+c.ingressCarousel.contentCarouselConfig.carouselName+":change:pageSize",r),c.variables.A.on("a:carousel:"+c.ingressCarousel.contentCarouselConfig.carouselName+":change:pageNumber",p));m=!0}},r=function(){for(var a=e;a<Math.min(c.ingressCarousel.auiCarousel.getAttr("pageSize"),c.variables.playList.length);a++)c.emitThumbnailMetric("rvs.thumbnailImpression",a);e=c.ingressCarousel.auiCarousel.getAttr("pageSize");
k=c.ingressCarousel.auiCarousel.getAttr("totalPages");e>=c.variables.playList.length&&(c.variables.A.off("a:carousel:"+c.ingressCarousel.contentCarouselConfig.carouselName+":change:pageSize",r),c.variables.A.off("a:carousel:"+c.ingressCarousel.contentCarouselConfig.carouselName+":change:pageNumber",p))},p=function(){var a=c.ingressCarousel.auiCarousel.getAttr("pageNumber"),b=e*(a-1),d=Math.min(b+e,c.variables.playList.length);1<a&&c.variables.A.off("a:carousel:"+c.ingressCarousel.contentCarouselConfig.carouselName+
":change:pageSize",r);if(a===g){for(a=b;a<d;a++)c.emitThumbnailMetric("rvs.thumbnailImpression",a);g++;d!==c.variables.playList.length&&g!==k+1||c.variables.A.off("a:carousel:"+c.ingressCarousel.contentCarouselConfig.carouselName+":change:pageNumber",p)}else if(a===k){for(a=b;a<d;a++)c.emitThumbnailMetric("rvs.thumbnailImpression",a);k--}};return{initializeClient:function(a,b,d,e,g,k,m,r){try{a.on("scroll",q);var t=a.now();a.$("#va-related-videos-widget_feature_div").removeClass("aok-hidden");a.$("#vse-spinner").removeClass("aok-hidden");
var p=z.fetchLatestPageState(a,"vse-dp-rv-config"),w=z.fetchLatestPageState(a,"vse-dp-vl-config"),x=z.fetchLatestPageState(a,"vse-dp-rvs-config"),y=z.fetchLatestPageState(a,"vse-dp-rvs-ad-metrics-url");c.variables.sushiMetricsConfig=z.fetchLatestPageState(a,"vse-dp-rvs-sushimetricsconfig");y&&y.url&&(c.variables.RVA_SUSHI_URL=y.url);if(p&&0!==p.length&&(p.showAdPlacement||w&&0!==w.length)){c.variables.sushiMetricsConfig&&c.variables.sushiMetricsConfig.hasOwnProperty("endpoint")?c.variables.universalSushiEndpoint=
c.variables.sushiMetricsConfig.endpoint:c.variables.universalSushiEndpoint="";c.variables.buildMetricPayload=c.makeMetricPayloadBuilder(c.variables.sushiMetricsConfig);c.variables.buildUniversalSushiPayload=c.makeApplicationSushiPayloadBuilder(a,c.variables.sushiMetricsConfig);e={gatedP:G,EventEmitter:M,promise:k};c.variables.libs=e;var C=new ca(b,a,e),D=new J(e),I=a.$.extend({},w.videoVoteConfig);I.hasOwnProperty("placementContext")&&(I.dependencies=e,c.variables.videoVoteContainerFactory=new H(a,
I),c.variables.showVideoVotes=w.showVideoVotes);var F=new R({modalFactory:d,contentCarouselFactory:C,$:a.$,A:a,buttonApi:g,awaFactory:D,videoVoteContainerFactory:c.variables.videoVoteContainerFactory,carouselFramework:b});c.ingressCarousel=C.create(p);c.variables.playList=c.ingressCarousel.getplaylist();1<=c.variables.playList.length&&p.autoplay&&c.AutoPlayInitialization(a,p,x,D);p.showAdPlacement||(c.lightbox=F.create(w),c.lightboxCarousel=c.lightbox.getCarousel(),f=c.registerClientEventOnce(a,p,
w,c.lightbox,c.ingressCarousel,f));a.off("a:declarative:vse-rvp-swf-share-network:click");a.on("a:declarative:vse-rvp-swf-share-network:click",function(b){u.count(l.socialShareClickMetricName,1);var c=a.state(l.socialSharePageStateName);V.share(c,b.data.network)});v.when("mash").execute("vse-mash-detection",function(b){c.isMshop=!0;c.mShopFactory=b;a.declarative("vse-rvp-social-share-mshop-action","click touch",function(a){a=c.ingressCarousel.getActiveAsset();Object.keys(c.lightboxCarousel.getActiveAsset()).length&&
(a=c.lightboxCarousel.getActiveAsset());a=c.getMshopShareParams(a.contentId,a.title);c.mShopFactory.share(a)})});b=S-r;var E=a.now();d=E-r;c.emitMetric(l.METRIC_TIME_TO_NOT_REGISTERED,b);c.emitMetric(l.METRIC_TIME_TO_REGISTERED,d);c.emitMetric(l.METRIC_INIT_CLIENT,E-t);c.emitMetric(l.METRIC_INIT_CLIENT_WAITING,t-r);a.$("#vse-spinner").addClass("aok-hidden");c.emitMetric(l.METRIC_PAGE_VIEW,1);""!==c.variables.universalSushiEndpoint&&c.emitThumbnailRenderMetric("rvs.thumbnailRender",1);p.autoplayTriggered&&
c.emitMetric(l.METRIC_PAGE_VIEW_MA,1)}}catch(ka){a.$("#va-related-videos-widget_feature_div").addClass("aok-hidden"),c.logFatal(ka,"vse-related-video-shorts","Failed to create the video light-box experience.")}},Utils:c,_noneFeature:a()}})})};v.when("A","3p-promise").execute("VSE-gatedP-register-client",function(a,b){S=a.now();G.register("VSE-RVS-client","VSE-RVS-client-registered",la,b)})})()});