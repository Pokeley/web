(function(H){var B=window.AmazonUIPageJS||window.P,F=B._namespace||B.attributeErrors,r=F?F("DetailPageMiraiAssets",""):B;r.guardFatal?r.guardFatal(H)(r,window):r.execute(function(){H(r,window)})})(function(H,B,F){H.when("A","jQuery","ready").execute("mirai-core",function(r,d){function w(a){var c=a.data();c.asin&&(c.asin=a.attr("data-asin"));return c}function W(a){a.find(".shopbylook-btf-item-like").click(function(){var a=null,b=null,e=0;d(this).hasClass("shopbylook-btf-desktop-left-section-b-right-img")&&
(a=d(this).closest(".shopbylook-btf-item-box-anchor"),b=d(this));null===a&&(a=d(this).closest(".shopbylook-btf-item-box"),b=d(this).find(".shopbylook-btf-item-like-img"),e=a.index(),n||h.hideAnchor||e++);var g=w(a);t++;b.hasClass("active")?(fa(a,g),Q(g,!0,"getRecommendationsForUnlikeDPX",e)):(ga(a,g),X(a,g),Q(g,!0,"getRecommendationsForLikeDPX",e));R()});a.find(".shopbylook-btf-item-dislike").click(function(){var a=null,b=null,e=0;d(this).hasClass("shopbylook-btf-desktop-left-section-b-left-img")&&
(a=d(this).closest(".shopbylook-btf-item-box-anchor"),b=d(this));null===a&&(a=d(this).closest(".shopbylook-btf-item-box"),b=d(this).find(".shopbylook-btf-item-dislike-img"),e=a.index(),n||h.hideAnchor||e++);var g=w(a);t++;b.hasClass("active")?(ga(a,g),Q(g,!1,"getRecommendationsForUndislikeDPX",e)):(fa(a,g),-1===q.indexOf("D"+g.asin)&&(q.push("D"+g.asin),p.push({asin:g.asin,iteration:t})),a=d(a).find(".shopbylook-btf-item-dislike-img"),a.attr("src",ha),a.addClass("active"),Q(g,!1,"getRecommendationsForDislikeDPX",
e));R()})}function va(){var a=f.find("#shopbylook-btf-items-section");f.find("#shopbylook-btf-mobile-show-more").click(function(){x++;a.addClass("shopbylook-btf-mobile-section-"+x);if(2===x||a.find(".shopbylook-btf-item-box").length<6*(x+1))d(this).hide(),d("#shopbylook-btf-explore-more").show()})}function X(a,c){-1===q.indexOf("L"+c.asin)&&(q.push("L"+c.asin),u.push({asin:c.asin,iteration:t}));var b=d(a).find(".shopbylook-btf-item-like-img");b.attr("src",ia);b.addClass("active")}function fa(a,c){for(var b=
!1,e=0;e<u.length;e++)if(u[e].asin===c.asin){u.splice(e,1);b=!0;break}for(e=0;e<q.length;e++)if(q[e]==="L"+c.asin){q.splice(e,1);break}b&&(b=d(a).find(".shopbylook-btf-item-like-img"),b.attr("src",Y),b.removeClass("active"))}function ga(a,c){for(var b=!1,e=0;e<p.length;e++)if(p[e].asin===c.asin){p.splice(e,1);b=!0;break}for(e=0;e<q.length;e++)if(q[e]==="D"+c.asin){q.splice(e,1);break}b&&(b=d(a).find(".shopbylook-btf-item-dislike-img"),b.attr("src",Z),b.removeClass("active"))}function I(){m&&(m.abort(),
m=null);var a=u;0===u.length&&0===p.length&&(a=[{asin:h.mainAsin,iteration:t}]);aa();m=d.ajax({type:"POST",url:"/discover/getRecommendationsDPX",data:JSON.stringify({browseNode:h.browseNode,anchorAsin:h.mainAsin,positive:a,negative:p,count:n?20:100,currentViewAsins:n?[]:[h.mainAsin],iteration:t,filters:k,isFilterChange:!0}),contentType:"application/json",dataType:"json",statusCode:{200:function(a){d("#shopbylook-btf-no-results-section").hide();var b=a.dpxRecommendationItemList;y=a.nextStart;a=f.find("#shopbylook-btf-items-section");
var e=a.find(".shopbylook-btf-item-box").first().clone();e.removeClass("shopbylook-btf-item-box-flip");a.empty();for(var g=0;g<b.length;g++){var D=e.clone(),h=b[g];J(D,h,!1);-1<q.indexOf("L"+h.asin)&&X(D,h);a.append(D)}W(a);a.removeClass("shopbylook-btf-items-section-p-"+S());1===K(b.length)&&a.addClass("shopbylook-btf-items-section-p-last");L();R();n&&2>x&&(b.length<6*(x+1)?(f.find("#shopbylook-btf-mobile-show-more").hide(),f.find("#shopbylook-btf-explore-more").show()):(f.find("#shopbylook-btf-mobile-show-more").show(),
f.find("#shopbylook-btf-explore-more").hide()))},204:function(){d("#shopbylook-btf-no-results-section").show();f.find("#shopbylook-btf-items-section").find(".shopbylook-btf-item-box:nth-child(n+2)").remove();n?(f.find("#shopbylook-btf-mobile-show-more").hide(),f.find("#shopbylook-btf-explore-more").show()):f.find("#sbl-btf-desktop-pagination").text(h.desktopPagination.replace("${page}",1).replace("${total}",1))}}}).always(function(){T();ja()})}function wa(){m&&(m.abort(),m=null);var a=f.find("#shopbylook-btf-items-section"),
c=a.find(".shopbylook-btf-item-box").length,b=S(),e=K(c);aa();if(100<=c||-1===y){if("last"===b||parseInt(b,10)>=e)"last"!==b&&(a.removeClass("shopbylook-btf-items-section-p-"+b),a.addClass("shopbylook-btf-items-section-p-last"));else{var g=parseInt(b,10)+1,g=g>=e?"last":g;a.removeClass("shopbylook-btf-items-section-p-"+b);a.addClass("shopbylook-btf-items-section-p-"+g)}L();T()}else g=u,0===u.length&&0===p.length&&(g=[{asin:h.mainAsin,iteration:t}]),m=d.ajax({type:"POST",url:"/discover/getRecommendationsDPX",
data:JSON.stringify({browseNode:h.browseNode,anchorAsin:h.mainAsin,positive:g,negative:p,currentViewAsins:ka(!1),start:y,count:100-c,filters:k,iteration:t}),contentType:"application/json",dataType:"json",statusCode:{424:function(){}},success:function(b){if(b&&b.dpxRecommendationItemList){var c=b.dpxRecommendationItemList;y=b.nextStart;b=a.find(".shopbylook-btf-item-box").filter(":visible").first().clone();b.removeClass("shopbylook-btf-item-box-flip");for(var d=0;d<c.length;d++){var e=b.clone(),g=
c[d];J(e,g,!1);-1<q.indexOf("L"+g.asin)&&X(e,g);a.append(e);W(e)}}else y=-1}}).always(function(){c=a.find(".shopbylook-btf-item-box").length;e=K(c);var d=parseInt(b,10)+1,d=d>=e?"last":d;a.removeClass("shopbylook-btf-items-section-p-"+b);a.addClass("shopbylook-btf-items-section-p-"+d);L();T()})}function xa(){m&&(m.abort(),m=null);var a=S(),c=f.find("#shopbylook-btf-items-section"),b=c.find(".shopbylook-btf-item-box").length,b=K(b);aa();b="last"===a||parseInt(a,10)>b?Math.max(1,b-1):Math.max(1,parseInt(a,
10)-1);c.removeClass("shopbylook-btf-items-section-p-"+a);c.addClass("shopbylook-btf-items-section-p-"+b);L();T()}function K(a){var c=ba();return-1!==y?Math.min(la,Math.ceil(100/c)):Math.min(la,Math.ceil(a/c))}function Q(a,c,b,e){m&&(m.abort(),m=null);if(0!==u.length||0!==p.length){var g=ka(c),D=ba(),l;l=n?c?2:1:Math.ceil(.2*D);var q=n&&c?6*(2-x):0;m=d.ajax({type:"POST",url:"/discover/"+b,data:JSON.stringify({browseNode:h.browseNode,anchorAsin:h.mainAsin,asin:a.asin,physicalId:a.physicalId,positive:u,
negative:p,currentViewAsins:g,count:l+q,filters:k,iteration:t,asinIndex:e}),contentType:"application/json",dataType:"json",statusCode:{200:function(b){var e=b.sortedCurrentViewAsins,g=b.dpxRecommendationItemList;y=b.nextStart;b=f.find("#shopbylook-btf-items-section").find(".shopbylook-btf-item-box").filter(":visible");var h=b.first().index(),k=l-1,m=0,v=0;c||(v=f.find("#shopbylook-btf-item-box-"+a.asin),J(v,g[k])&&k--);for(;0<=k&&m<e.length-1;)for(v=m;v<e.length;v++){var m=v,t=f.find("#shopbylook-btf-item-box-"+
e[v]),p=t,u=h,w=z?u+D:u+D-1;if(!p.find(".shopbylook-btf-item-like-img").hasClass("active")&&p.index()>=u&&p.index()<w&&(n?r.onScreen(p,0):1)&&J(t,g[k])){k--;break}}if(0<q)for(e=6*(x+1),v=l;v<g.length;v++)h=f.find(".shopbylook-btf-item-box").eq(e++),J(h,g[v],!1);if(20<b.length)for(v=20;v<b.length;v++)g=d(b[v]),g.hasClass("shopbylook-btf-item-explore-more")||g.remove()}}}).always(function(){})}}function ka(a){var c=f.find(".shopbylook-btf-item-box"),b=c.map(function(){return w(d(this)).asin}).get();
n||(b.push(h.mainAsin),z&&(b.length=Math.min(b.length,1+c.filter(":hidden").length+Math.min(20,c.filter(":visible").length))));return n&&a?b.splice(0,6*(x+1)):b}function J(a,c,b){if(null===a||0===a.length||c===F)return!1;(b===F||b)&&a.toggleClass("shopbylook-btf-item-box-flip");var d=a.find(".shopbylook-btf-item-price").children("span");b=a.find(".shopbylook-btf-item-ratings");var g=a.find(".shopbylook-btf-image-elem"),f=a.find(".shopbylook-btf-item-dislike-img"),k=a.find(".shopbylook-btf-item-like-img");
a.attr("data-asin",c.asin);a.data("asin",c.asin);a.attr("data-physical-id",c.physicalId);a.data("physicalId",c.physicalId);a.attr("id","shopbylook-btf-item-box-"+c.asin);g.attr("src",c.imageAddress);g.attr("alt",c.title);g.attr("title",c.title);a.find(".shopbylook-btf-item-image").children("a").attr("href","/dp/"+c.asin+"/ref\x3dsbl_dpx_"+(n?"m_":"")+h.mainAsin+"_"+t);d.text(c.price);c.prime?a.addClass("shopbylook-prime"):a.removeClass("shopbylook-prime");c=c.rating;if(!(0>=a.find(".shopbylook-btf-item-ratings-row").length)&&
b){for(a=0;5>=a;a++)b.removeClass("a-star-mini-"+a).removeClass("a-star-mini-"+a+"-5");!c||.5>c?b.addClass("shopbylook-ratings-hide"):(a=Math.floor(c),b.addClass("a-star-mini-"+a+(.5<=c-a?"-5":"")),b.removeClass("shopbylook-ratings-hide"))}f.attr("src",Z);f.removeClass("active");k.attr("src",Y);k.removeClass("active");return!0}function ba(){if(n)return 6*(x+1);var a=f.find("#shopbylook-btf-items-section");return 2*Math.floor(a.width()/a.children().eq(0).width())}function R(){var a="/discover/bn/"+
h.browseNode+"/ref\x3dsbl_dpe_"+(n?"m_":"")+h.mainAsin+"_"+t+"?displayAsins\x3d"+h.mainAsin+(0<q.length?"\x26asins\x3d"+q.slice(-50).join():"")+(0<k.length?"\x26sblKeywords\x3d"+encodeURIComponent(k.join()):"");f.find("#shopbylook-btf-explore-more").attr("href",a)}function aa(){f.find("#shopbylook-btf-loading-section").show()}function T(){f.find("#shopbylook-btf-loading-section").hide()}function ya(){f.find("input[type\x3dcheckbox], input[type\x3dradio]").click(function(){ma(d(this))})}function ma(a){var c=
a.prop("checked"),b=w(a.closest(".sbl-refinements-bn-list")),e=b.refinementType,g="@"+e,f=w(a.closest(".refinement-row")).refinementValue,b=z&&"browse"===b.refinementSource,l="";U=!0;var l=b?f:g+(f?":"+f:""),m=a.closest(".sbl-refinements-bn-list").find("input[type\x3d'checkbox']:checked").length,b=k.indexOf(l);if(z){g=w(a.closest(".refinement-row")).refinementIndex;d(".sbl_refinement_"+e+"_selected").each(function(){p=d(this);if("review"===e){d(".review-checkbox").each(function(){d(this).find("input[type\x3d'checkbox']:checked").prop("checked",
!1)});for(var a=0;a<k.length;a++)if(/^@review/.test(k[a])&&k[a]!==l){k.splice(a,1);break}0<m?p.text(h.refinementStarsAndUp.replace("${count}",f)):p.text("")}else 0<m?p.text("("+m+")"):p.text("");0<m?d("#sbl-refinement-item-"+e).addClass(n?"sbl-refinement-item-mobile-selected":"sbl-refinement-item-selected"):d("#sbl-refinement-item-"+e).removeClass(n?"sbl-refinement-item-mobile-selected":"sbl-refinement-item-selected")});d("."+e+"-"+g+"-checkbox").each(function(){d(this).find("input[type\x3d'checkbox']").prop("checked",
c)});"prime"===e&&(f="prime");if("review"===e){0<m?d(".sbl_refinement_review_title").hide():d(".sbl_refinement_review_title").show();for(var q=0;4>q;q++)q!==g&&d(".sbl-keyword-item-"+e+"-"+q).each(function(){na(d(this))})}-1<b?k.splice(b,1):k.push(l);b=d(".sbl-keyword-item-"+e+"-"+g);c&&!b.length?(b=d(".sbl-filter-keyword-hidden").clone(),b.appendTo("#sbl-keywords-row"),"review"===e?b.find(".sbl-filter-keyword-text").text(h.refinementStarsAndUp.replace("${count}",f)):"prime"!==e?b.find(".sbl-filter-keyword-text").text(d(".sbl_refinement_"+
e+"_title")[0].textContent+": "+a.closest("."+e+"-"+g+"-checkbox").text()):a.closest(".refinement-row").find(".a-icon-prime").clone().addClass("sbl-keyword-prime-icon").appendTo(b.find(".sbl-filter-keyword-text")),za(b,a,e,g)):!c&&b.length&&b.each(function(){na(d(this))})}else{var p=d("#sbl_refinement_"+e+"_selected");if("@review"===g){a.closest(".sbl-refinements-bn-list").find("input[type\x3d'checkbox']").prop("checked",!1);a.prop("checked",c);for(a=0;a<k.length;a++)if(/^@review/.test(k[a])&&k[a]!==
l){k.splice(a,1);break}0<m?(p.text(h.refinementStarsAndUp.replace("${count}",f)),d("#sbl_refinement_review_title").hide()):(p.text(""),d("#sbl_refinement_review_title").show())}else 0<m?p.text("("+m+")"):p.text("");-1<b?k.splice(b,1):k.push(l)}n||I()}function L(){var a=f.find("#shopbylook-btf-items-section").find(".shopbylook-btf-item-box").length,a=y?a:100,c=S(),a=K(a),c="last"===c||parseInt(c,10)>a?a:parseInt(c,10),c=h.desktopPagination.replace("${page}",c).replace("${total}",a);f.find("#sbl-btf-desktop-pagination").text(c);
n||(a=f.find("#shopbylook-btf-items-section").find(".shopbylook-btf-item-box"),c=a.filter(":hidden"),a=a.filter(":visible"),0<c.length?f.find("#shopbylook-btf-prev-button").show():f.find("#shopbylook-btf-prev-button").hide(),a.length<=ba()&&y?f.find("#shopbylook-btf-next-button").hide():f.find("#shopbylook-btf-next-button").show())}function oa(){var a=null!==M&&0<M.length&&M.is(":visible")?M:f;800>Math.floor(a.width())?G.addClass("shopbylook-btf-remove-anchor"):G.removeClass("shopbylook-btf-remove-anchor");
L();z&&!n&&null!==E&&pa()}function S(){try{for(var a=f.find("#shopbylook-btf-items-section").attr("class"),a=a.split(" "),c=0;c<a.length;c++)if(a[c].includes("shopbylook-btf-items-section-p-"))return a[c].replace("shopbylook-btf-items-section-p-","")}catch(b){}return"1"}function Aa(a){var c=a.find("#sbl-refinements-list");N=a.find("#sbl-refinement-options");O=a.find("#refinement-divider");c.find(".refinement-filter").bind("click mouseover",function(){var a=c.find("#"+w(d(this)).filterDiv);!a||A&&
A.attr("id")===a.attr("id")||(C?C.removeClass("sbl-selected"):O.show(),C=d(this),C.addClass("sbl-selected"),N.width(210),a.show(),A&&A.hide(),A=a)})}function qa(a){z?(d(".refinement-button-selected-value").each(function(){d(this).text("")}),d(".sbl_refinement_review_title").show()):d(".refinement-type-section").each(function(){var a=d(this),b=w(a).refinementType,e=a.closest("#sbl_refinement_"+b+"_selected");"review"===b&&a.closest(".sbl_refinement_review_title").show();e.text("")});d(".refinement-row").find("input[type\x3d'checkbox']:checked").each(function(){d(this).prop("checked",
!1)});d(".sbl-filter-keyword-container:not(.sbl-filter-keyword-hidden)").remove();n?d(".sbl-refinement-item-mobile-selected").removeClass("sbl-refinement-item-mobile-selected"):d(".sbl-refinement-item-selected").removeClass("sbl-refinement-item-selected");k=[];(a===F||a)&&I()}function pa(){if(null===E){E=d(".sbl-filter-top-section").length;V=d(".refinement-filter").length;for(var a=0;a<E;a++)ca.push(d("#sbl-top-filter-"+a).width());da=d("#sbl-filter-selection").width();ea=d("#sbl-btf-desktop-pagination").width()+
d("#sbl-explore-more").width()}for(var a=d("#sbl-btf-refinement-row").width()-ea-da-150,c=l=0;l<E;){c+=ca[l];if(c>a)break;d("#sbl-top-filter-"+l).show();d("#sbl-refinement-"+l).hide();l++}l=1!==V-l?l:l-1;l===V?d("#sbl-more-filters-popover").hide():d("#sbl-more-filters-popover").show();P&&0===l?(d("#sbl-filter-title").show(),d("#sbl-filter-show-more").hide(),P=!1):!P&&0<l&&(d("#sbl-filter-title").hide(),d("#sbl-filter-show-more").show(),P=!0);for(a=l;a<E;a++)d("#sbl-top-filter-"+a).hide(),d("#sbl-refinement-"+
a).show();ja()}function ja(){if(z){var a=k.length;a||f.removeClass("sbl-filter-keywords-activate");if(!n&&a&&0<l)for(var c=0;c<l;c++)a-=d(".sbl-top-checkbox-"+c).find("input[type\x3d'checkbox']:checked").length;0<a?(n?d("#sbl-refinement-item-all").addClass("sbl-refinement-item-mobile-selected"):d("#sbl-more-filters-popover").addClass("sbl-refinement-item-selected"),d("#sbl-show-more-selected").text("("+a+")")):(n?d("#sbl-refinement-item-all").removeClass("sbl-refinement-item-mobile-selected"):d("#sbl-more-filters-popover").removeClass("sbl-refinement-item-selected"),
d("#sbl-show-more-selected").text(""))}}function Ba(){H.when("a-sheet").register("sbl-bottom-sheet",function(a){function c(a){a?B.scrollTo(0,Math.abs(ra)):ra=parseInt(sa.css("top"),10)}sa=d("#a-page");Ca.forEach(function(a){r.on("a:sheet:beforeShow:sbl"+a+"Sheet",function(c){var g=a.toLowerCase();c=d("#refinement-"+g+"-sheet");var g=d("#sbl-"+g+"-refinement-buttons").height(),f=0,f=0;"All"===a?(g=0,f=.8*B.innerHeight):(f=35*c.find(".refinement-row").length+40,g=60,f=Math.min(.8*B.innerHeight-g-12,
f));0<f&&(c.find(".sbl-mobile-filters").height(f),c.closest(".a-sheet-web").height(f+g))});r.on("a:sheet:afterShow:sbl"+a+"Sheet",function(a){c(!1)});r.on("a:sheet:beforeHide:sbl"+a+"Sheet",function(a){U&&(I(),U=!1);a.sheet.$container.find(".sbl-refinement-expander-header").each(function(){d(this).find(".a-icon-section-collapse").length&&d(this).trigger("click")})});r.on("a:sheet:afterHide:sbl"+a+"Sheet",function(a){c(!0)})})})}function na(a){n&&I();r.animate(a,{width:"0",margin:"0",opacity:"0"},
350,"ease-out",function(){a.remove()})}function za(a,c,b,d){a.addClass("sbl-keyword-item-"+b+"-"+d);f.addClass("sbl-filter-keywords-activate");a.click(function(){c.prop("checked",!1);ma(c)});a.removeClass("sbl-filter-keyword-hidden").width(a.width())}function ta(){f=d("#mirai-btf-shopbylook-row");if(0<f.length){G=d("#desktop-dp-btf-shopbylook");M=0<G.length?G.find("h2"):null;var a=r.state("shopbylookStateData");a||f.hide();var c=w(f),b=c.mainAsin;h&&h.mainAsin===b||h&&!b||!a||(h=a,h.mainAsin=b?b:
h.mainAsin,h.browseNode=c.browseNode?c.browseNode:h.browseNode,u=[],p=[],q=[],x=t=0,y=null,k=[],n=0<f.find(".shopbylook-btf-mobile-section").length,Y=h.likeImage,ia=h.likeActiveImage,Z=h.dislikeImage,ha=h.dislikeActiveImage,R(),W(f),z=0<f.find("#sbl-refinement-btn-clear").length,n&&(va(),f.find(".sbl-refinement-btn-apply").click(I)),ya(),f.find("#shopbylook-btf-next-button").click(wa),f.find("#shopbylook-btf-prev-button").click(xa),oa(),B.addEventListener("resize",oa),!z)||(ca=[],da=ea=null,P=!0,
V=E=null,l=0,C=O=N=A=null,U=!1,f.find("#sbl-refinement-btn-clear").click(qa),n?ua||(Ba(),ua=!0):(Aa(G),pa()),qa(!1))}else h&&(h.mainAsin=null)}var Z="dislike.svg",ha="dislike_active.svg",Y="like.svg",ia="like_active.svg",la=Math.floor(10),h,f,G,M,n=!1,z=!1,u=[],p=[],q=[],t=0,x=0,y=null,m=null,k=[],ca=[],ea=null,da=null,P=!0,E=null,V=null,l=0,A=null,N=null,O=null,C=null,Ca=["0","1","2","All"],ua=!1,U=!1,ra=0,sa=null;r.on("a:popover:hide:refinementPreloads",function(){A&&(A.hide(),A=null);N&&N.width(0);
O&&O.hide();C&&(C.removeClass("sbl-selected"),C=null)});r.on("a:pageUpdate",function(){ta()});ta()})});